---
title: <h0>Module 9-2 vSphere Distributed Resource Scheduler</h0>
author: cotes   
categories: [cisco virtual cloud,2025-03-11-cisco]
tags: [Network, Cloud, vShphere]








---

# vSphere Distributed Resource Scheduler



## vSphere Distributed Resource Scheduler

------

**학습 목표(Learner Objectives)**

1. **vSphere DRS 클러스터의 기능 설명**
   * vSphere 분산 리소스 스케줄러(DRS)는 클러스터 내 ESXi 호스트 간에 워크로드를 자동으로 분산하여 리소스 사용을 최적화한다.
   * 동적인 VM 배치 및 마이그레이션을 통해 성능을 향상시키고, 리소스 활용률을 극대화할 수 있다.

2. ------

   **vSphere DRS가 클러스터 내에서 VM을 배치하는 방식 설명**

   * DRS는 CPU 및 메모리 사용률을 기준으로 VM을 최적의 호스트로 자동 배치한다.
   * 초기 배치 시 VM의 요구 사항과 호스트의 가용 리소스를 평가하여 적절한 호스트를 선택한다.
   * 실행 중인 VM의 리소스 요구 사항이 변경되면 vMotion을 사용하여 VM을 다른 호스트로 이동시킬 수 있다.

3. **vSphere DRS 설정의 사용 사례 인식**
   * 리소스 부하 균형 조정: 호스트 간 리소스 사용률 차이가 클 경우, DRS가 VM을 재배치하여 균형을 유지한다.
   * 성능 최적화: CPU 및 메모리 병목 현상을 최소화하기 위해 자동으로 VM을 이동한다.
   * 유지보수 지원: 호스트를 유지보수 모드로 전환하면, 실행 중인 VM을 자동으로 다른 호스트로 이동시킨다.

4. **클러스터에서 vSphere DRS 구성**
   * DRS 기능을 활성화하고, 클러스터 내에서 자동화 수준을 설정할 수 있다.
   * 리소스 할당 정책을 정의하여 특정 VM 또는 리소스 풀에 우선순위를 부여할 수 있다.
   * DRS의 임계값을 조정하여 마이그레이션 민감도를 조절할 수 있다.

5. **vSphere DRS 클러스터 모니터링**
   * DRS 이벤트 및 마이그레이션 기록을 확인하여 리소스 균형 상태를 평가한다.
   * 호스트 및 VM의 리소스 사용량을 분석하여 추가적인 조정이 필요한지 검토한다.
   * vSphere 성능 차트를 활용하여 DRS의 영향을 실시간으로 모니터링할 수 있다.

------



**이러한 기능을 활용하면 vSphere 환경에서 리소스 활용률을 최적화하고, VM 성능을 향상시키며, 관리자의 개입 없이도 원활한 운영이 가능하다.**

------

------

## **vSphere Distributed Resource Scheduler(DRS)**

![image-20250311131236391](/assets/cisco_post_img/2025-03-11-Module 9-2 vSphere Distributed Resource Scheduler//image-20250311131236391.png)

 **클러스터 내 모든 호스트의 리소스 할당을 최적화하는 기능이다.**



------

**vSphere DRS의 주요 기능**

* 가상 머신(VM)이 실행될 때 초기 배치 결정
* 클러스터 내 부하 분산
* ESXi 호스트가 유지보수 모드로 전환될 때 VM 마이그레이션



------

**vSphere DRS 동작 방식**

vSphere DRS는 여러 서버의 컴퓨팅 용량을 논리적 리소스 풀로 통합한다.

* **Fully Automated 모드: DRS가 자동으로 리소스가 가장 많은 호스트에 VM을 배치**
* **Partially Automated 또는 Manual 모드: DRS가 리소스 할당 권장 사항을 제공**

------

**vSphere DRS의 VM 마이그레이션**

* DRS는 vSphere vMotion을 사용하여 자동으로 VM을 이동하거나, 수동 마이그레이션을 추천할 수 있음
* ESXi 호스트가 유지보수 모드로 들어가기 전에 VM은 다른 호스트로 자동 또는 수동으로 이동하거나 종료, 일시 정지될 수 있음



**그림 설명**

​	•	ESXi 호스트가 여러 개의 물리적 서버 위에서 실행됨

​	•	클러스터 내에서 VM이 리소스를 공유하며, 필요에 따라 vSphere vMotion을 통해 이동 가능



------

------



## vSphere DRS



vSphere DRS는 VM 단위로 운영된다.

​	•	VM이 실행 중일 때, DRS는 각 VM의 리소스 요구 사항을 충족하도록 조정한다.

​	•	DRS는 각 VM의 점수를 계산하고, VM의 리소스 요구 사항을 충족하기 위한 마이그레이션 추천(또는 직접 마이그레이션 수행)을 제공한다.

​	•	DRS 알고리즘은 최적의 성능을 위해 개별 VM이 어느 호스트로 이동해야 하는지를 분석하여 추천한다.

​	•	클러스터가 Fully Automated 모드인 경우, DRS는 매분마다 계산을 수행하여 추천을 실행하고, VM을 최적의 호스트로 자동 마이그레이션한다.



------

------





## **About the VM DRS Score**

![image-20250311121258683](/assets/cisco_post_img/9-2//image-20250311121258683.png)

* **VM DRS 점수**는 VM의 리소스 요구 사항 충족 정도를 추적한다.
* **점수가 0%에 가까울수록 심각한 리소스 경합이 발생하고 있음을 나타낸다.**
* **점수가 100%에 가까울수록 경합이 적거나 없음을 나타낸다.**
* VM DRS 점수는 각 VM의 CPU, 메모리, 네트워크 지표를 바탕으로 계산된다. DRS는 이러한 지표를 사용하여 VM의 리소스 상태를 평가한다.
* vSphere 7 이상에서는 DRS 알고리즘이 매분마다 실행된다.
* **Cluster DRS 점수**는 DRS가 실행된 마지막 결과로, 5개의 구간 중 하나로 분류된다. 각 구간은 20% 범위로 나뉘며, 해당 범위는 0-20, 20-40, 40-60, 60-80, 80-100%로 나뉜다.

------

------

## **vSphere DRS 클러스터 요구 사항**



ESXi 호스트는 vSphere DRS 클러스터에서 특정 요구 사항을 충족해야 하며, 이를 통해 클러스터 기능을 제대로 사용할 수 있습니다:

1. **vSphere vMotion 네트워크 요구 사항**
   * 부하 분산을 위해 **vSphere DRS**를 사용하려면 클러스터의 호스트가 vSphere vMotion 네트워크에 속해야 합니다.
   * vSphere vMotion 네트워크에 포함되지 않은 경우에도 **vSphere DRS**는 초기 배치 추천만 할 수 있습니다.

2. **vSphere vMotion 요구 사항 충족**
   * **vSphere DRS**는 VM이 **vSphere vMotion** 요구 사항을 충족할 때 최적의 성능을 발휘합니다.

3. **공유 저장소 구성**
   * 모든 관리 호스트는 공유 저장소를 사용하도록 구성해야 합니다.

------

------

## vSphere DRS 설정: 자동화 수준

![image-20250311121942821](/assets/cisco_post_img/9-2//image-20250311121942821.png)

VM의 초기 배치 및 실행 중인 VM의 동적 균형을 위해 자동화 수준을 구성할 수 있다.

자동화 수준은 vSphere DRS가 마이그레이션 추천을 하는지 아니면 VM을 호스트에 자동으로 배치하는지를 결정한다. vSphere DRS는 VM을 켤 때와 클러스터 내에서 VM의 균형을 맞춰야 할 때 배치 결정을 내린다.



다음은 사용 가능한 자동화 수준이다:

* 수동: VM을 켤 때, vSphere DRS는 VM을 배치할 추천 호스트 목록을 표시한다. 클러스터의 전반적인 DRS 점수를 개선하기 위해, vSphere DRS는 수동 VM 마이그레이션 추천을 표시한다.
* 부분 자동화: VM을 켤 때, vSphere DRS는 가장 적합한 호스트에 VM을 배치한다. 클러스터의 전반적인 DRS 점수를 개선하기 위해, vSphere DRS는 수동 VM 마이그레이션 추천을 표시한다.
* 완전 자동화: VM을 켤 때, vSphere DRS는 가장 적합한 호스트에 VM을 배치한다. 클러스터의 전반적인 DRS 점수를 개선하기 위해, vSphere DRS는 VM을 호스트 간에 자동으로 마이그레이션한다.

------

------

## vSphere DRS 설정: 마이그레이션 임계값

![image-20250311122347190](/assets/cisco_post_img/9-2//image-20250311122347190.png)

마이그레이션 임계값은 vSphere DRS가 얼마나 적극적으로 VM을 마이그레이션할지를 결정한다.

다음은 사용 가능한 마이그레이션 임계값 설정이다:

* **레벨 1 (보수적)**: 우선 순위 1 추천만 적용한다. vCenter는 VM의 요구 사항을 충족하기 위해 반드시 수행해야 하는 추천만 적용한다. 예를 들어, 친화성 규칙 및 호스트 유지 관리가 포함된다.
* **레벨 2**: 우선 순위 1 및 우선 순위 2 추천을 적용한다. vCenter는 클러스터의 전반적인 DRS 점수를 크게 향상시킬 수 있는 추천을 적용한다.
* **레벨 3 (기본값)**: 우선 순위 1, 우선 순위 2, 우선 순위 3 추천을 적용한다. vCenter는 클러스터의 전반적인 DRS 점수를 적어도 잘 향상시킬 수 있는 추천을 적용한다.
* **레벨 4**: 우선 순위 1, 우선 순위 2, 우선 순위 3, 우선 순위 4 추천을 적용한다. vCenter는 클러스터의 전반적인 DRS 점수를 중간 정도 향상시킬 수 있는 추천을 적용한다.
* **레벨 5 (적극적)**: 모든 추천을 적용한다. vCenter는 클러스터의 전반적인 DRS 점수를 약간이라도 향상시킬 수 있는 추천을 모두 적용한다.

------

------

## vSphere DRS 설정: 예측 DRS

![image-20250311122441082](/assets/cisco_post_img/9-2//image-20250311122441082.png)

예측 DRS는 미래의 자원 수요를 예측하고 자원 사용이 높은 시점과 위치를 결정하는 데 사용된다.

예측 결정을 내리기 위해 vSphere DRS 데이터 수집기는 다음 데이터를 가져온다:

​	•	**ESXi 호스트의 자원 사용 통계**

​	•	**VMware Aria Operations 서버의 예측 사용 통계**



예측 DRS의 목표는 다음과 같다:

​	•	**VM의 DRS 점수가 떨어지기 전에 VM을 이동시킨다.**

​	•	**호스트 자원이 경합 상태에 도달하기 전에 마이그레이션을 수행한다.**



예측 사용 통계는 항상 현재 사용 통계보다 우선시된다.

------

------

## Viewing vSphere DRS Settings

![image-20250311122618518](/assets/cisco_post_img/9-2//image-20250311122618518.png)

------

------

## vSphere DRS Settings: VM-Level Automation (vSphere DRS 설정: VM 수준 자동화)

![image-20250311122700674](/assets/cisco_post_img/9-2//image-20250311122700674.png)

클러스터 내 개별 VM에 대해 자동화 수준을 맞춤 설정하여 전체 클러스터에 설정된 자동화 수준을 덮어쓸 수 있다.

개별 VM에 대한 자동화 수준을 설정하면 필요에 맞게 자동화를 세밀하게 조정할 수 있다. 예를 들어, 비즈니스에 특히 중요한 VM이 있을 수 있다. 이 VM에 대해 더 많은 제어를 원하면 자동화 수준을 **수동(Manual)**으로 설정할 수 있다.



VM의 자동화 수준이 **비활성화(Disabled)**로 설정되면, vSphere DRS는 해당 VM을 마이그레이션하지 않으며, 초기 배치나 마이그레이션 추천도 제공하지 않는다.



자동화 수준은 환경과 편안함 수준에 따라 선택한다. 예를 들어, vSphere DRS 클러스터에 익숙하지 않다면 **부분 자동화(Partially Automated)**를 선택하여 VM의 이동을 더 많이 제어할 수 있다.

vSphere DRS가 수행하는 작업과 작동 방식에 익숙해지면 자동화 수준을 **완전 자동화(Fully Automated)**로 설정할 수 있다.

비즈니스에 중요한 VM에 대해서는 **수동(Manual)**으로 자동화 수준을 설정할 수 있다.

------

------

## vSphere DRS 설정: VM 스왑 파일 위치

![image-20250311122940895](/assets/cisco_post_img/9-2//image-20250311122940895.png)

ESXi 호스트는 VM 스왑 파일을 로컬 데이터스토어에 배치하도록 구성할 수 있다.

vSphere DRS가 구성된 경우, VM 스왑 파일은 공유 데이터스토어에 배치하는 것이 좋다.



VMFS 또는 NFS 데이터스토어에서는 VM의 스왑 공간이 두 개의 스왑 파일로 구성된다.

vSAN 또는 vSphere Virtual Volumes 데이터스토어에서는 스왑 파일이 별도의 객체로 생성된다.



ESXi 호스트는 VM이 켜질 때 두 개의 스왑 파일을 생성한다. 이 파일들이 생성되지 않으면 VM은 켜지지 않는다.



기본적으로 VM의 스왑 파일은 다른 VM 파일이 위치한 폴더의 데이터스토어에 있다. 기본값을 사용하는 대신 다음 옵션을 사용할 수 있다:

1. **VM별 구성 옵션**을 사용하여 데이터스토어를 다른 공유 스토리지 위치로 변경.

2. **호스트 로컬 스왑**을 사용하여 로컬 호스트의 데이터스토어에 스왑을 지정. 이는 호스트별 수준에서 스왑을 할 수 있다. 그러나 이는 **vSphere vMotion** 성능에 약간의 성능 저하를 일으킬 수 있다. 이는 소스 호스트에서 로컬 스왑 파일로 스왑된 페이지가 네트워크를 통해 대상 호스트로 전송되기 때문이다. 현재 vSAN과 vSphere Virtual Volumes 데이터스토어는 호스트 로컬 스왑으로 지정할 수 없다.

------

------

## vSphere DRS Settings: VM Affinity (vSphere DRS 설정: VM 친화성)

![image-20250311123240174](/assets/cisco_post_img/9-2//image-20250311123240174.png)

vSphere DRS 가상 머신 친화성 규칙은 선택된 VM들이 동일 호스트에 배치되거나 다른 호스트에 배치되도록 지정한다.

1. Affinity rules(**친화성 규칙**): 상호간에 많이 통신하는 VM들을 동일한 호스트에 배치한다.
2. Anti-affinity rules(**반대 친화성 규칙**): 로드 밸런싱이나 고가용성을 원할 경우, VM들이 서로 다른 호스트에 배치되도록 한다.



vSphere DRS 클러스터가 생성된 후, 클러스터의 속성을 편집하여 친화성 규칙을 생성할 수 있다. 생성할 수 있는 규칙은 다음과 같다:

1. **친화성 규칙**: 특정 VM들을 동일한 호스트에 배치한다(예: 성능상의 이유).
2. **반대 친화성 규칙**: 특정 VM들이 서로 다른 호스트에 배치되도록 한다(예: 가용성상의 이유).



두 규칙이 충돌하면, 두 규칙을 동시에 활성화할 수 없다.



규칙을 추가하거나 수정할 때, 클러스터가 즉시 규칙 위반 상태에 있을 경우, 클러스터는 계속 작동하며 위반을 수정하려고 시도한다.



vSphere DRS 클러스터가 **수동** 또는 **부분 자동화** 수준의 자동화로 설정된 경우, 마이그레이션 추천은 규칙 충족과 로드 밸런싱을 모두 고려하여 이루어진다.

------

------

## vSphere DRS Settings: DRS Groups

![image-20250311125410419](/assets/cisco_post_img/2025-03-11-Module 9-2 vSphere Distributed Resource Scheduler//image-20250311125410419.png)



------

------

## vSphere DRS Settings: VM-Host Affinity Rules(vSphere DRS 설정: VM-호스트 친화성 규칙)

![image-20250311125715194](/assets/cisco_post_img/2025-03-11-Module 9-2 vSphere Distributed Resource Scheduler//image-20250311125715194.png)





VM-호스트 친화성 규칙은 다음과 같은 방식으로 정의된다:

1. **친화성 규칙** 또는 **반대 친화성 규칙**을 정의한다.
2. VM 그룹과 호스트 그룹 간의 친화성(또는 반대 친화성) 관계를 정의한다.



**규칙 옵션:**

1. **호스트 그룹에서 실행해야 한다**: VM이 지정된 호스트 그룹에서 실행되어야 한다.
2. **호스트 그룹에서 실행해야 한다 (우선순위)**: VM이 지정된 호스트 그룹에서 실행되도록 우선 권장된다.
3. **호스트 그룹에서 실행하지 말아야 한다**: VM이 지정된 호스트 그룹에서 실행되지 않도록 한다.
4. **호스트 그룹에서 실행하지 말아야 한다 (우선순위)**: VM이 지정된 호스트 그룹에서 실행되지 않도록 우선 권장된다.



VM-호스트 친화성 규칙 또는 반대 친화성 규칙은 선택된 **VM 그룹**이 특정 **호스트 그룹**에서 실행될 수 있는지 여부를 지정한다.



VM 간 친화성 규칙은 개별 VM 간의 친화성 관계를 지정하는 반면, VM-호스트 친화성 규칙은 **VM 그룹**과 **호스트 그룹** 간의 관계를 정의한다.



VM-호스트 친화성 규칙은 클러스터 기반이므로, 규칙에 포함된 VM과 호스트는 모두 동일 클러스터 내에 존재해야 한다. VM이 클러스터에서 제거되면, 그 VM은 모든 VM 그룹에서 제거되며, 나중에 클러스터로 돌아와도 다시 그룹에 포함되지 않는다.

------

------

## VM-Host Affinity Preferential Rules (**VM-호스트 친화성 우선 규칙**)

![image-20250311125855543](/assets/cisco_post_img/2025-03-11-Module 9-2 vSphere Distributed Resource Scheduler//image-20250311125855543.png)





**우선 규칙**은 부드럽게 적용되며 필요 시 위반될 수 있다. 예를 들어, 성능 향상을 위해 서로 다른 blade 시스템에 VM을 분리하여 배치하는 경우가 해당된다.



**우선 규칙 위반 가능성:**

* **vSphere DRS**, **vSphere HA**, **vSphere DPM**의 정상 작동을 위해 우선 규칙은 위반될 수 있다.



**예시:**

* **그룹 A**와 **그룹 B**는 각각 VM 그룹이고, **Blade Chassis A**와 **Blade Chassis B**는 호스트 그룹이다.
* 목표는 **그룹 A**의 VM들이 **Blade Chassis A** 내 호스트에서 실행되도록 하고, **그룹 B**의 VM들이 **Blade Chassis B** 내 호스트에서 실행되도록 강제하는 것이다.
* 만약 호스트에 장애가 발생하면, **vSphere HA**는 해당 VM을 클러스터 내 다른 호스트에서 재시작한다.
* **vSphere DRS**는 호스트가 유지 보수 모드로 전환되거나, 호스트가 VM의 리소스 요구 사항을 충족하기 위해 필요할 경우 VM을 다른 호스트로 이동시킨다.



이 규칙은 VM과 호스트 간에 우선적인 관계를 설정하면서도, 필요한 경우 시스템의 정상적인 기능을 위해 규칙을 위반할 수 있는 유연성을 제공한다.

------

------

## **VM-호스트 친화성 필수 규칙 (Required Rules)**

![image-20250311130051649](/assets/cisco_post_img/2025-03-11-Module 9-2 vSphere Distributed Resource Scheduler//image-20250311130051649.png)

**필수 규칙**은 엄격하게 적용되며 절대 위반될 수 없다. 예를 들어, **호스트 기반 ISV 라이선스**를 강제 적용하는 경우가 해당된다.



**필수 규칙의 특징:**

​	•	소프트웨어가 실행되는 VM에 **라이선스 제한이 있는 경우** 적용 가능하다.

​	•	특정 VM을 **VM 그룹**에 배치한 후, 해당 VM이 특정 **호스트 그룹**에서 실행되도록 강제하는 규칙을 만든다.

​	•	이 규칙을 설정하면, **해당 라이선스를 보유한 호스트에서만 실행되도록 제한할 수 있다.**



**주의할 점:**

​	•	해당 규칙은 VM에서 실행 중인 **소프트웨어를 모니터링하지 않으며**, **어떤 ESXi 호스트에 특정 서드파티 라이선스가 있는지 인식하지 못한다.**

​	•	사용자가 직접 VM 그룹과 호스트 그룹을 올바르게 설정해야 한다.



**예시:**

​	•	**Group A**는 VM 그룹이다.

​	•	**ISV-Licensed**는 특정 라이선스를 보유한 호스트 그룹이다.

​	•	**Group A**의 VM이 **ISV-Licensed** 그룹 내 호스트에서만 실행되도록 강제할 수 있다.



**제약 사항:**

​	•	**ISV-Licensed 그룹의 호스트가 장애가 발생하면, vSphere HA는 Group A의 VM을 다른 호스트에서 재시작할 수 없다.**

​	•	**ISV-Licensed 그룹의 호스트가 유지보수 모드로 전환되거나 과부하가 발생하면, vSphere DRS는 Group A의 VM을 해당 그룹이 아닌 다른 호스트로 이동할 수 없다.**



이 규칙은 **특정 라이선스 또는 하드웨어 요구사항**을 충족하는 환경에서 VM의 실행 위치를 엄격히 제어할 때 사용된다.

------

------

## Viewing vSphere DRS Cluster Resource Utilization

![image-20250311130231549](/assets/cisco_post_img/2025-03-11-Module 9-2 vSphere Distributed Resource Scheduler//image-20250311130231549.png)

------

------

## Viewing vSphere DRS Recommendations

![image-20250311130314378](/assets/cisco_post_img/2025-03-11-Module 9-2 vSphere Distributed Resource Scheduler//image-20250311130314378.png)

------

------

**Maintenance Mode와 Standby Mode**

![image-20250311130449194](/assets/cisco_post_img/2025-03-11-Module 9-2 vSphere Distributed Resource Scheduler//image-20250311130449194.png)

**Maintenance Mode**

* **클러스터 내 호스트를 점검하기 위해 사용됨**
* *호스트의 리소스를 사용할 수 없도록 설정됨**
* 사용자가 직접 요청하여 호스트가 유지보수 모드에 진입하거나 해제됨
* 유지보수 모드에서는 VM을 배포하거나 전원을 켤 수 없음
* 유지보수 모드로 진입하는 호스트에서 실행 중인 VM은 종료되거나 일시 중단되거나 다른 호스트로 수동 또는 자동(vSphere DRS) 마이그레이션됨
* 모든 VM이 이동한 후, 호스트는 **유지보수 모드 아이콘**으로 표시됨
* **사용 사례**:
  * 메모리 추가 등 하드웨어 변경
  * 클러스터에서 호스트 제거



------

**Standby Mode**

* **vSphere DPM(Dynamic Power Management)이 전력 최적화를 위해 사용**
* **호스트가 대기 모드로 전환되면, 전원이 꺼짐**
* **Baseboard Management Controller(BMC)는 호스트 전원이 꺼져도 계속 동작함**
* **사용자가 직접 호스트를 대기 모드로 설정 가능**
* vSphere DRS가 실행될 때, 설정이 자동으로 해제되거나 유지보수 모드로 전환될 수도 있음
* **호스트를 완전히 종료하려면 유지보수 모드로 전환한 후 수동으로 전원을 꺼야 함**

------

------

## **Removing a Host from the vSphere DRS Cluster (vSphere DRS 클러스터에서 호스트 제거)**

**호스트 제거 절차**

1. **호스트를 유지보수 모드로 전환**
   * 실행 중인 모든 VM을 다른 호스트로 마이그레이션하거나, 종료 또는 일시 중단해야 함
   * vSphere DRS가 **완전 자동 모드**일 경우, 유지보수 모드로 진입한 호스트의 VM은 자동으로 마이그레이션됨

2. **호스트를 다른 인벤토리 위치로 이동**
   * 데이터센터 또는 다른 클러스터로 호스트를 드래그하여 이동 가능

3. **클러스터에서 사용 가능한 리소스 감소**
   * 클러스터에서 제거된 호스트의 리소스는 더 이상 사용되지 않음
   * 클러스터의 리소스 할당이 조정됨



**추가 고려 사항**

* **로컬 스토리지에 디스크를 가진 VM**
* 반드시 종료, 일시 중단하거나, **다른 호스트 및 데이터스토어로 마이그레이션**해야 함
* **클러스터 내 가용 리소스 검토**
* 클러스터가 남아있는 VM의 예약된 리소스를 충족할 수 있어야 하며, 부족할 경우 조정 필요

------

------


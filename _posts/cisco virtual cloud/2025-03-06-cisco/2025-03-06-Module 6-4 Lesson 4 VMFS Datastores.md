---
title: <h0>Module 6-4 Lesson 4 VMFS Datastores</h0>
author: cotes   
categories: [cisco virtual cloud, 2025-03-06-cisco]
tags: [Network, Cloud]

















---

# Lesson 4 VMFS Datastores

------

## **VMFS 데이터스토어 개요**



------

**1. VMFS란?**

VMFS(VMware vSphere Virtual Machine File System)는 **고성능 클러스터 파일 시스템**으로, ESXi 환경에서 **가상 머신(VM) 파일을 저장하고 관리하는 역할**을 한다.

​	•	**클러스터 파일 시스템:** 여러 ESXi 호스트가 동시에 같은 VMFS 데이터스토어를 공유할 수 있음.

​	•	**스토리지 최적화:** 가상 디스크(VMDK) 및 VM 메모리 이미지(스냅샷, 일시 중단된 VM) 저장을 위한 고성능 구조 제공.



------

**2. VMFS의 주요 특징**

​	•	**대용량 지원:** 최대 **64TB** 크기의 단일 볼륨을 생성할 수 있음.

​	•	**동적 확장:** 필요할 때 기존 VMFS 데이터스토어를 **온라인 상태에서 확장 가능**.

​	•	**데이터 보호:** ESXi 호스트 간의 **분산 파일 잠금(On-Disk Locking)** 기능을 통해 데이터 충돌 방지.

​	•	**스냅샷 및 복제 지원:** VM의 상태를 저장하는 스냅샷을 활용하여 백업 및 복제 가능.



------

**3. VMFS 데이터스토어 구조 (그림 설명)**



아래 그림은 **VMFS 데이터스토어의 개념적 구조**를 나타냄.



📌 **VMFS 데이터스토어 구성 요소:**

​	1.	**ESXi 호스트**: 여러 ESXi 호스트가 VMFS 데이터스토어에 접근 가능.

​	2.	**VMFS 데이터스토어**: 가상 머신의 VMDK, VM 설정 파일(.vmx), 로그 파일, ISO 이미지 등이 저장됨.

​	3.	**공유 스토리지 (SAN/NAS/iSCSI)**: 다수의 ESXi 호스트가 동일한 VMFS 볼륨을 공유하여 고가용성을 제공함.



(🔹 **여기에 그림 포함 가능**: VMFS 데이터스토어와 ESXi 호스트 간의 관계를 보여주는 다이어그램)

이제부터는 **자세한 요약 + 그림 설명**을 원하면 이렇게 작성할 예정.

------

------

## **VMFS 데이터스토어 크기 확장**

 ![image-20250306123701424](/assets/cisco_post_img/2025-03-06-Module 6-4 Lesson 4 VMFS Datastores//image-20250306123701424.png)

VMFS 데이터스토어의 크기를 증가시키는 것은 가상 머신(VM)에 더 많은 저장 공간을 제공하거나 성능을 향상시키기 위한 중요한 작업이다.



------

**1. 크기 변경 전 고려 사항**

​	•	변경하기 전에 **스토리지 재검색(Rescan)** 을 수행하여 모든 호스트가 최신 스토리지를 인식하도록 해야 한다.

​	•	확장할 데이터스토어의 **고유 식별자(예: NAA ID)** 를 기록해야 한다.



------

**2. VMFS 데이터스토어 크기 증가 방법**



VMFS 데이터스토어의 크기를 동적으로 확장하는 방법은 두 가지가 있다.

1. **확장 추가(Extent 추가)**
   * Extent는 LUN(논리적 유닛)에서 생성된 파티션으로, VMFS 데이터스토어에 새로운 Extent를 추가하여 데이터스토어를 확장할 수 있다.
   * 하나의 VMFS 데이터스토어는 최대 **32개의 Extent** 까지 확장 가능하다.

2. **기존 Extent 확장**
   * VMFS 데이터스토어의 크기를 증가시키려면 **기존 Extent의 크기를 확장**해야 한다.
   * 확장하려는 Extent가 포함된 LUN이 확장 가능해야 한다.



------

**3. 주의할 점**

​	•	VMFS 데이터스토어의 크기를 **확장(Expand)** 할 수 있지만, 한 번 확장된 데이터스토어는 **축소(Shrink)** 할 수 없다.

​	•	데이터스토어의 크기를 증가시킬 때, 사용 가능한 공간을 확인하고 가용한 LUN이 충분한지 검토해야 한다.



------



**그림 설명**

​	•	첫 번째 단계: 원래의 두 개의 저장소가 존재함.

​	•	두 번째 단계: VMFS01이라는 데이터스토어를 확장하여 더 많은 저장 공간을 제공함.

​	•	세 번째 단계: VMFS 데이터스토어 크기가 증가하는 과정.

​	•	주의 사항: **VMFS 데이터스토어는 확장은 가능하지만 축소할 수 없다.**

------

------

## **Multipathing 알고리즘**

![image-20250306131527183](/assets/cisco_post_img/2025-03-06-Module 6-4 Lesson 4 VMFS Datastores//image-20250306131527183.png)

스토리지 어레이(Storage Array)는 **Active-Active** 및 **Active-Passive** 스토리지 프로세서를 제공하며, 이를 효과적으로 활용하기 위해 vSphere는 다양한 다중 경로(Multipathing) 알고리즘을 지원한다.



------

**1. Multipathing 개요**

​	•	**vSphere Native Path Selection:** 기본적인 경로 선택 및 로드 밸런싱 기능 제공.

​	•	**Failover Mechanism:** 특정 경로 장애 발생 시 다른 경로로 자동 전환.

​	•	**Third-Party Multipathing Plug-ins:** 스토리지 벤더가 ESXi와 효과적으로 상호작용하도록 플러그인을 개발 가능.



------

**2. Pluggable Storage Architecture (PSA)**

​	•	PSA는 VMkernel의 한 계층으로 **여러 스토리지 경로를 관리하고 로드 밸런싱을 제공하는 역할**을 한다.

​	•	ESXi 호스트는 **Active-Active** 또는 **Active-Passive** 스토리지 어레이와 연결 가능하다.



------

**3. VMware 기본 경로 선택 정책**



vSphere에서는 다음과 같은 네이티브 경로 선택 정책을 제공한다.

1. **Round Robin**
   * 모든 활성 경로를 순환하면서 로드 밸런싱 수행.
   * I/O 트래픽이 여러 경로로 균등하게 분산됨.
   * **Active-Active 스토리지 어레이에 적합.**

2. **Most Recently Used (MRU)**
   * 가장 최근에 사용된 경로를 계속 사용.
   * 기존 경로가 실패하면 다른 경로로 전환되지만, 장애 복구 후에도 원래 경로로 되돌아가지 않음.
   * **Active-Passive 스토리지 어레이에 적합.**

3. **Fixed**
   * 관리자가 설정한 기본 경로를 항상 사용.
   * 기본 경로가 실패할 경우 다른 경로로 전환되지만, 장애 복구 후 원래 경로로 되돌아감.
   * **Active-Active 및 특정 Active-Passive 환경에 적합.**



------

**4. 서드파티 플러그인 지원**

​	•	서드파티 스토리지 벤더는 자체적인 로드 밸런싱 및 장애 복구 메커니즘을 설계할 수 있다.

​	•	ESXi와의 원활한 통합을 위해 PSA와 호환되는 플러그인을 제공할 수 있음.



------



**그림 설명**

1. **Active-Active 및 Active-Passive 스토리지 프로세서 구성**
   * **SP A** 및 **SP B**는 각각 경로 0과 1을 제공.
   * 두 개의 독립적인 스위치를 통해 다중 경로가 설정됨.

2. **Multipathing을 활용한 I/O 분산**
   * 여러 경로를 통해 데이터가 균등하게 배분되는 방식 설명.
   * 특정 경로 장애 시 다른 경로로 I/O 트래픽이 우회됨.

3. **다양한 PSA 정책 적용 가능**
   * Round Robin, MRU, Fixed 등의 정책을 활용하여 경로를 선택하고 장애 조치(Failover) 가능.



이와 같은 다중 경로(Multipathing) 기법을 활용하면, vSphere 환경에서 **스토리지 성능을 최적화하고, 장애 발생 시 빠르게 복구할 수 있는 환경을 구축**할 수 있다.

------

------

### 기타

-- 디스크 파일 --

~~ . vmdk

~~ . flat.vmdk <--- CLI 로 확인

------

-- configuration 파일 --

~.vmx

------

서버 증설

1. scale out
2. scale up
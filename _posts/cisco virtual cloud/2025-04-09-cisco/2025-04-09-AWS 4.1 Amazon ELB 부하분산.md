---
title: <h0>AWS 4.1 Amazon ELB 부하분산</h0>
author: cotes 
categories: [cisco virtual cloud,2025-04-09-cisco]
tags: [Network,AWS]



---

# AWS Amazon ELB 부하분산

------

## 

## **부하 분산(Load Balancing) 상세 설명**  
---

#### **1. 부하 분산이란?**  
부하 분산은 **다수의 서버에 트래픽을 균등하게 분배**하여 단일 서버의 과부하를 방지하고 시스템의 **성능, 가용성, 확장성**을 높이는 기술입니다.  

또한  서버-클라이언트 환경에서 서버가 클라이언트 요청을 받아 처리하는 과정에서 발생하는 부하(연산-작업)에 대해 동일한 목적을 수행하는 다수의 서버에 분산 처리하는 기능입니다.

- **목적**:  
  - 서버 장애 시 트래픽 자동 재분배 (**내결함성**).  
  - 사용자 요청 처리 지연 최소화 (**저지연**).  
  - 서버 자원 활용 최적화 (**비용 효율성**).  

---

#### **2. 로드 밸런서(Load Balancer)의 역할**  
로드 밸런서는 클라이언트와 서버 사이에서 **트래픽을 분산**하는 장치/소프트웨어입니다.  

##### **(1) 동작 원리**  
1. **클라이언트 요청 수신**: 사용자 요청을 로드 밸런서가 먼저 받음.  
2. **서버 선택**: 사전 정의된 알고리즘(라운드 로빈, 최소 연결 등)으로 적절한 서버 선택.  
3. **트래픽 전달**: 선택된 서버로 요청 전송.  
4. **응답 반환**: 서버의 응답을 클라이언트에게 전달.  

##### **(2) 주요 알고리즘**  
| **알고리즘**         | **설명**                                                     |
| -------------------- | ------------------------------------------------------------ |
| **라운드 로빈**      | 요청을 순차적으로 분배 (단순 균등 분할).                     |
| **최소 연결**        | 현재 연결 수가 가장 적은 서버 선택.                          |
| **가중 라운드 로빈** | 서버 성능에 따라 가중치 부여 (예: 고사양 서버에 더 많은 트래픽). |
| **지리적 라우팅**    | 사용자 위치 기반 최적 서버 선택.                             |

---

#### **3. 고가용성(High Availability)**  
- **정의**: 시스템이 **중단 없이 지속적으로 운영**되는 능력.  
- **로드 밸런서의 역할**:  
  - **장애 감지**: 서버 Health Check를 주기적으로 수행.  
  - **트래픽 재라우팅**: 장애 서버를 자동으로 제외하고 정상 서버로 요청 전달.  
- **구현 방법**:  
  - **Active-Standby**: 주 서버 장애 시 대기 서버로 즉시 전환.  
  - **Active-Active**: 모든 서버가 동시에 트래픽 처리.  

---

#### **4. 내결함성(Fault Tolerance)**  
- **정의**: 일부 서버/컴포넌트 장애 시에도 **시스템 전체가 정상 작동**하는 능력.  
- **로드 밸런서의 역할**:  
  - **자동 복구**: 장애 서버를 풀에서 제거 후 복구 시 재통합.  
  - **다중 AZ 구성**: 서버를 다른 가용 영역(AZ)에 분산 배치.  

---

#### **5. Amazon ELB (Elastic Load Balancing)**  
AWS에서 제공하는 완전관리형 로드 밸런싱 서비스로, **고가용성과 확장성**을 기본 지원합니다.  

##### **(1) 주요 기능**  
| **기능**               | **설명**                                                   |
| ---------------------- | ---------------------------------------------------------- |
| **다중 프로토콜 지원** | HTTP/HTTPS, TCP/UDP, WebSocket 프로토콜 처리.              |
| **자동 확장**          | 트래픽 증가 시 자동으로 용량 확장 (사전 구성 불필요).      |
| **SSL/TLS 종료**       | 로드 밸런서에서 SSL 암호화 복호화를 처리해 서버 부하 감소. |
| **Health Check**       | 주기적 서버 상태 확인 (응답 시간, HTTP 상태 코드 기준).    |
| **로그 및 모니터링**   | CloudWatch와 연동해 트래픽 및 성능 지표 모니터링.          |

##### **(2) ELB 유형**  
| **유형**              | **사용 사례**                                  | **특징**                                |
| --------------------- | ---------------------------------------------- | --------------------------------------- |
| **ALB (Application)** | HTTP/HTTPS 기반 애플리케이션 (마이크로서비스). | 경로/호스트 기반 라우팅, 컨테이너 지원. |
| **NLB (Network)**     | 초고성능 TCP/UDP 트래픽 (게임, 실시간 앱).     | 초저지연 (밀리초 단위), 고정 IP 제공.   |
| **GLB (Gateway)**     | Layer 3 (IP) 트래픽 (VPN, IoT).                | 대규모 트래픽 처리 (초당 수백만 요청).  |
| **CLB (Classic)**     | 레거시 애플리케이션 (EC2-Classic).             | 점차 ALB/NLB로 대체 중.                 |

##### **(3) 요금 구조**  
- **시간당 요금**: 사용 시간당 $0.0225 ~ $0.025 (유형 및 리전별 차이).  
- **데이터 처리 요금**: GB당 $0.008 ~ $0.01.  
- **무료 티어**: 월 750시간 + 15GB 데이터 처리 무료.  

---

## **Amazon ELB (Elastic Load Balancing) 구성 요소 상세 설명**  
AWS ELB는 **로드 밸런서**, **리스너**, **대상 그룹** 3가지 핵심 요소로 구성됩니다. 각 요소의 역할과 작동 방식을 상세히 설명합니다.

---

#### **1. 로드 밸런서 (Load Balancer)**  
**역할**: 클라이언트의 트래픽을 **대상 그룹**에 등록된 서버(EC2, 컨테이너 등)로 분산합니다.  

##### 로드 밸런서 속성**  
- **DNS 이름**: 클라이언트가 접근할 엔드포인트 (예: `my-alb-1234567890.us-east-1.elb.amazonaws.com`).  
- **가용 영역**: 로드 밸런서를 배치할 AZ 선택 (Multi-AZ 권장).  
- **보안 그룹**: 인바운드/아웃바운드 트래픽 제어.  

---

#### **2. 대상 그룹 (Target Group)**  
**역할**: 로드 밸런서가 트래픽을 전달할 **대상 서버 집합**을 정의합니다.  

##### **대상 유형**  
- **EC2 인스턴스**: 직접 등록 가능.  
- **IP 주소**: 온프레미스 서버 또는 다른 VPC의 리소스.  
- **Lambda 함수**: ALB만 지원 (서버리스 아키텍처).  
- **ALB/NLB**: 다른 로드 밸런서와 연결 (계층화된 구성).  

##### **대상 그룹 설정**  
| **설정 항목**            | **설명**                    | **예시 값**            |
| ------------------------ | --------------------------- | ---------------------- |
| **프로토콜/포트**        | 대상 서버와 통신할 프로토콜 | HTTP:8080              |
| **Health Check**         | 서버 상태 확인 방법         | HTTP 200 OK, 30초 간격 |
| **Stickiness**           | 동일 사용자 세션 유지       | 쿠키 기반 24시간       |
| **로드 밸런싱 알고리즘** | 트래픽 분산 방식            | 라운드 로빈, 최소 연결 |

##### **Health Check 동작**  
1. 로드 밸런서가 대상 서버에 **HTTP/HTTPS/TCP 요청** 전송.  
2. 응답이 지정된 조건(예: 200 OK)과 일치하지 않으면 **장애 상태**로 판단.  
3. 장애 서버는 트래픽 분배에서 제외.  

---

#### **3. 리스너 (Listener)**  
**역할**: 지정된 **포트/프로토콜**로 들어오는 트래픽을 **대상 그룹**으로 라우팅합니다.  

##### **리스너 규칙 (ALB 기준)**  
| **규칙 유형**   | **설명**                  | **예시**                                |
| --------------- | ------------------------- | --------------------------------------- |
| **경로 기반**   | URL 경로별 대상 그룹 지정 | `/api/*` → API 서버 그룹                |
| **호스트 기반** | 도메인별 대상 그룹 지정   | `app.example.com` → 웹 서버 그룹        |
| **헤더 기반**   | HTTP 헤더 값 필터링       | `User-Agent: Mobile` → 모바일 서버 그룹 |

---

### **ELB 작동 흐름 예시**  

1. **클라이언트 요청 수신: 로드밸런서는  클라이언트와 연결을 유지하며, 요청을 수신하려고 리스너를 등록합니다.**

2. **대상 그룹 선택: 대상 그룹은 인스턴스, IP 주소, 람다 함수, ALB 등 여러 유형의 대상으로 구성됩니다.**

3. **트래픽 분산: 선택된 대상 그룹에서 요청을 처리할 대상으로 선택하고 해당 대상으로 요청을 분산합니다.** 

   **이때 로드 밸런서는 각 대상의 가용성 상태를 모니터링 하고 가용하지 않은 대상을 제외**

4. **응답변환: 응답은 로드 밸런서에서 수신한 것으로 반환되므로, 클라이언트는 로드 밸런서가 대상 그룹에서 선택한 대상에게서 마치 응답을 받는 것처럼 느낄 수 있습니다.**

---

### ELB를 생성할 때 로드 밸런서와의 통신 방식

* 인터넷 경계 로드 밸런서: 외부에서 직접 로드 밸런서에 접근하는 방식
* 내부 로드 밸런서: 외부의 접근이 차단된 격리된 네트워크(내부 서버 전용)에서 로드 밸런서를 사용하는 방식



------

------

## Amazon ELB 교차 영역 로드 밸런싱

Amazon ELB는 여러 가용 영역에서 로드 밸런서 노드를 실행하며, 각 노드는 가용 영역 내 대상 그룹으로 요청을 분산합니다.

이때 대상 그룹에 등록된 대상이 여러 가용 영역에 걸쳐 있다면 기본적으로 로드 밸런서는 동일한 비중으로 가용 영역 내에 있는 대상으로 트래픽을 분산합니다.

<img src="../../../assets/cisco_post_img/2025-04-09-AWS 4.1 Amazon ELB 부하분산/IMG_0650.jpeg" alt="IMG_0650" style="zoom: 25%;" />

------

앞의 그림에서 가용 영역별로 로드 밸런서가 배치되고 다수의 인스턴스가 구성되어 있습니다.

> [!IMPORTANT]
>
> **이러한 불균형 로드 밸런싱을 해결하는 데 Amazon ELB에서 제공하는 교차 영역 로드 밸런싱을 사용할 수 있는데,**
>
> **ELB 교차 영역 로드 벨런싱은 여러 가용 영역에 걸쳐 있는 EC2 인스턴스나 컨테이너 등 새당을 더 효과적으로 로드 밸런싱을 하는 기업이다.**	

### 과정

1. **대상 인스턴스 수량이 첫 번째 가용 영역은 2대 , 두 번째 가용 영역은 여덟 대로 영역별로 불균형하게 구성**
2. **사용자 PC에서 ELB 도메인 주소로 트래픽을 전송하면, 도메인을 해석하여 50:50 비중으로 각 가용 영역에 위치한 로드 밸런서로 전달**
3. **첫 번째 로드 밸런서는 총 50이라는 비중에서 2대의 대상 인스턴스에 25의 비중으로 트래픽을 로드 밸런싱**
4. **두 번째 로드밸런서도 총 50이라는 비중에서 여덟 대의 대상 인스턴스에 6.25 비중으로 트래픽을 로드 밸런싱을 할 것**

### 결과 도출

**따라서 첫 번째 가용 영역에 위치한 대상 인스턴스에 트래픽 부하도가 높아지게 되며, 전체적으로 로드 밸런싱이 불균형해지는 것을 확인할 수 있습니다.**

------

------

## Amazon ELB 종류

------

### CLB

**CLB(classic load balancer) - Amazon ELB의 가장 초기에 출시된 로드 밸런서로, 4계층과 7계층 프로토콜을 모두 지원합니다.**

#### **특징**

* **HTTP/HTTPS 요청에 따른 최신 HTTPv1.2 프로토콜과 TCP의 SSL/TLS 암호화 프로토콜도 지원하며, SSL 인증서를 사용**
* **고정 IP 주소를 사용하여 로드 밸런서를 생성하고, 로드 밸런서에 대한 DNS 이름으로 엑세스 가능**
* **CLB는 서버의 기본 주소가 변경되면 로드 밸런서를 새로 생성해야 합니다.**

------

### ALB(Application Load Balancer)

**ALB - AWS 에서 제공하는 1.7 로드 밸런서로, HTTP/HTTPS 같은 웹 애플리케이션 프로토콜을 지원합니다.**

**또한 ALB는 대상 그룹 단위로 트래픽을 분산하며, 각 대상 그룹은 ALB가 요청을 전달할 EC2 인스턴스, 람다 함수, 컨테이너 및 IP 주소로 라우팅하는 기능을 제공합니다.**

#### 특징

* **HTTP 헤더를 롹인하여 다양한 라우팅 기능을 제공합니다.**
  * **경로 기반 라우팅: URL 경로를 기반으로 요청을 분산합니다.**
  * **호스트 기반 라우팅: 호스트 이름을 기반으로 요청을 분산합니다.**
  * **쿼리 문자열 기반 라우팅: URL 쿼리 문자열을 기반으로 요청을 분산합니다.**
* **오토 스케일링과 함께 사용하여 확장성 있는 애플리케이션을 구성할 수 있습니다.**
* **대상 그룹 내 인스턴스에 대해 상태 검사를 수행하고, 문제가 발생하면 자동으로 장애 조치를 취할 수 있습니다.**
* **Amazon CloudWatch Logs 와 통합되어 로그 및 지표 데이터를 수집하고 모니터링 및 분석을 할 수 있습니다.**

------

### NLB(Network Load Balancing)

**NLB - NLB는 앞서 설명한 ALB와 달리, 클라이언트와 로드 밸런서 간 연결을  TCP 레벨에서 유지하므로 대규모 트래픽을 처리하며, 동일한 IP 주소에서 여러 대상 그룹을 지원할 수 있습니다.**

**특징**

* **높은 처리량: 초당 수백만 개의 연결을 처리할 수 있습니다.**
* **빠른 응답 시간: 빠른 응답 시간을 위해 최적화된 L4 로드 밸런싱 알고리즘을 사용합니다.**
* **높은 가용성: 여러 가용 영역에서 인스턴스를 실행하고 매우 빠른 인스턴스 검색을 수행하여 신속하게 장애를 복구합니다.**
* **IP 주소 보존: 클라이언트 IP 주소를 원래 IP 주소로 보존할 수 있습니다. 이것은 클라이언트 IP 주소를 유지하면서 로드 밸런싱을 수행할 수 있다는 것을 의미합니다.**

------

### GWLB(Gateway Load Balancer)

GWLB - 네트워크 트래픽을 서드 파티의 방화벽/어플라이언스 장비로 부하분산 처리하는 로드 밸런서입니다.

특징

* 서드 파티의 방화벽/어플라이언스를 쉽게 배포하고 확장 및 괸리를 할 수 있습니다.
* 요청에 따라 트래픽을 확장하거나 축소하면서 다수의 서드 파티 장비에 로드 밸런싱을 처리합니다.
* GWLB는 VPC 내에서 실행되는 애플리케이션의 가용성과 확장성을 향상시키는데 사용되며, TCP 및 UDP 프로토콜을 지원하여 다양한 유형의 애플리케이션에 유연하게 적용이 가능합니다.

##### **ELB 유형별 차이**  

| **유형**              | **계층**          | **프로토콜**         | **주요 기능**                              | **사용 사례**         |
| --------------------- | ----------------- | -------------------- | ------------------------------------------ | --------------------- |
| **ALB** (Application) | L7 (애플리케이션) | HTTP/HTTPS/WebSocket | - 경로/호스트 기반 라우팅<br>- Lambda 통합 | 웹 앱, 마이크로서비스 |
| **NLB** (Network)     | L4 (전송)         | TCP/UDP/TLS          | - 초저지연 (<100ms)<br>- 고정 IP 제공      | 게임, 실시간 스트리밍 |
| **GLB** (Gateway)     | L3 (네트워크)     | IP                   | - 대규모 트래픽 처리 (초당 100만+ 요청)    | VPN, IoT              |

##### **

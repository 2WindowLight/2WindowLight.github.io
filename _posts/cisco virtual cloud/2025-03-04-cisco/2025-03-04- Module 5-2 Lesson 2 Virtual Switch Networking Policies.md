---
title: <h0>Module 5-2 Virtual Switch Networking Policies</h0>
author: cotes   
categories: [cisco virtual cloud, 2025-03-04-cisco]
tags: [Network, Cloud, vShphere]














---

# Lesson 2 Virtual Switch Networking Policies



------



## **가상 스위치 네트워크 정책 (Virtual Switch Networking Policies)**



관리자는 가상 네트워크 속성(보안, 성능, 가용성)을 구성하기 위해 가상 스위치에서 네트워크 정책을 설정할 수 있습니다.

가상 스위치 유형에 따라 네트워크 정책이 적용되는 수준이 다를 수 있습니다.

| **가상 스위치 유형**                         | **기본 정책 설정 위치** | **기본 정책 재정의 가능 위치** |
| -------------------------------------------- | ----------------------- | ------------------------------ |
| **vSphere 표준 스위치 (Standard Switch)**    | 표준 스위치 레벨        | 포트 그룹 레벨                 |
| **vSphere 분산 스위치 (Distributed Switch)** | 분산 포트 그룹 레벨     | 개별 포트 레벨                 |

**네트워크 정책 설명:**

**보안 정책 (Security Policy)**:

​	•	MAC 주소 변조 방지 및 불필요한 포트 스캔으로부터 보호합니다.

**트래픽 셰이핑 정책 (Traffic Shaping Policy)**:

​	•	특정 VM 또는 VM 그룹에 대한 트래픽 양을 제한할 때 사용됩니다.

**팀 및 페일오버 정책 (Teaming and Failover Policy)**:

​	•	VM 및 VMkernel 어댑터의 네트워크 트래픽이 물리적 어댑터 간에 어떻게 분배되는지 결정합니다.

​	•	물리적 어댑터 장애 시 트래픽을 어떻게 우회할 것인지 설정합니다.

------

------

## **보안 정책 구성 (Configuring Security Policies)**

![image-20250304145749469](/assets/cisco_post_img/2025-03-04- Module 5-2 Lesson 2 Virtual Switch Networking Policies//image-20250304145749469.png)

**관리자는 표준 스위치 수준과 포트 그룹 수준에서 보안 정책을 정의할 수 있습니다.**

**보안 정책 설정**

1. **Promiscuous Mode (무차별 모드)**

​	•	목적지와 관계없이 모든 트래픽을 전달할지 여부를 결정.

​	•	기본값: **Reject (거부)**

​	•	허용 시 패킷 분석 도구(NIDS) 사용 가능.

2. **MAC Address Changes (MAC 주소 변경)**

​	•	게스트 OS가 가상 NIC의 MAC 주소를 변경할 경우 트래픽 허용 여부 결정.

​	•	기본값: **Reject (거부)**

​	•	거부 시 MAC 스푸핑 공격 방지 가능.

3. **Forged Transmits (변조된 전송)**

​	•	게스트 OS가 가상 NIC의 원래 MAC 주소와 다른 주소로 전송할 경우 허용 여부 결정.

​	•	기본값: **Reject (거부)**

​	•	거부 시 네트워크 보안 강화.



**권장 설정**

​	•	보안을 위해 기본적으로 **모든 정책을 Reject (거부)** 설정하는 것이 좋음.

​	•	다만, 패킷 분석이나 특정 방화벽 애플리케이션을 사용해야 할 경우 일부 설정을 Accept (허용)으로 변경 가능.



**예외적인 설정 사례**

​	•	**Promiscuous Mode → Accept** : 패킷 스니핑, 네트워크 분석 도구(NIDS) 실행 시 필요.

​	•	**MAC Address Changes & Forged Transmits → Accept** : 특정 게스트 OS 기반 방화벽 또는 MAC 주소 변경이 필요한 애플리케이션 사용 시 필요.



**결론**

​	•	기본적으로 **Reject 유지**, 특별한 경우에만 **Accept 적용**.

------

------

## Traffic-Shaping Policies

![image-20250304150520045](/assets/cisco_post_img/2025-03-04- Module 5-2 Lesson 2 Virtual Switch Networking Policies//image-20250304150520045.png)

**트래픽 셰이핑 정책 (Traffic Shaping Policies)**



트래픽 셰이핑은 가상 머신이 사용할 수 있는 네트워크 대역폭을 제한하는 기능이다. 기본적으로 비활성화되어 있으며, 필요에 따라 설정할 수 있다. 주요 설정 항목은 다음과 같다.

**1. 평균 대역폭 (Average Bandwidth, Kbps)**

​	•	포트에서 허용되는 평균 대역폭을 설정한다.

​	•	초당 몇 Kbps까지 허용할지를 결정하며, 장기간의 트래픽 흐름을 조절하는 역할을 한다.

​	•	기본적으로 네트워크 대역폭이 평준화되도록 유지된다.

**2. 최대 대역폭 (Peak Bandwidth, Kbps)**

​	•	트래픽이 순간적으로 증가할 경우 허용할 수 있는 최대 대역폭을 설정한다.

​	•	평균 대역폭보다 높은 값으로 설정할 수 있으며, 버스트 크기(Burst Size) 내에서만 적용된다.

​	•	일시적으로 높은 전송 속도를 허용해야 하는 경우 활용할 수 있다.

**3. 버스트 크기 (Burst Size, KB)**

​	•	순간적으로 사용할 수 있는 최대 데이터 크기를 설정한다.

​	•	평균 대역폭을 초과하지 않는 경우, 남은 대역폭을 누적하여 사용할 수 있다.

​	•	설정된 버스트 크기 이상으로 데이터가 전송될 수 없으며, 일정량이 저장되었다가 필요할 때 빠르게 전송된다.

**4. 트래픽 셰이핑 동작 방식**

​	•	가상 머신의 네트워크 트래픽이 설정된 **평균 대역폭 이하**이면 정상적으로 전송된다.

​	•	순간적으로 대역폭을 더 사용해야 할 경우, **버스트 크기**가 있다면 **최대 대역폭(Peak Bandwidth)** 까지 허용된다.

​	•	버스트 크기를 사용한 후에는 다시 **평균 대역폭 속도**로 제한된다.

**5. 트래픽 셰이핑 적용 사례**

​	•	특정 가상 머신이 과도한 네트워크 대역폭을 점유하지 않도록 제한할 때.

​	•	네트워크 리소스를 공평하게 분배하여 다른 가상 머신의 성능 저하를 방지할 때.

​	•	제한된 네트워크 환경에서 특정 워크로드의 트래픽을 조절할 때.

**기본적으로 트래픽 셰이핑은 비활성화되어 있으며, 필요한 때만 활성화하는 것이 좋다.**

------

------

## **NIC 팀 구성 및 장애 조치 (Configuring NIC Teaming and Failover)**

![image-20250304151846109](/assets/cisco_post_img/2025-03-04- Module 5-2 Lesson 2 Virtual Switch Networking Policies//image-20250304151846109.png)



**NIC 팀 구성(NIC Teaming)**은 여러 개의 물리적 NIC(uplink)를 하나의 그룹으로 묶어 네트워크 대역폭을 증가시키고, 장애 발생 시 트래픽을 자동으로 다른 NIC로 전환하는 기능이다.

**NIC 팀 구성의 주요 장점:**

​	•	**네트워크 대역폭 증가**: 여러 개의 NIC를 팀으로 구성하여 트래픽 부하를 분산할 수 있다.

​	•	**장애 조치(Failover) 지원**: 특정 NIC에 장애가 발생하면 자동으로 다른 NIC가 트래픽을 처리하도록 설정할 수 있다.

**NIC 팀 구성 설정 방법**

1. **물리적 NIC 추가**

​	•	하나의 포트 그룹에 두 개 이상의 물리적 NIC(uplink)를 추가한다.

2. **로드 밸런싱 정책 설정**

​	•	**출력 트래픽(load balancing)**: 가상 스위치(vSwitch)에서 각 물리적 NIC로 트래픽을 어떻게 분배할지 결정한다.

​	•	**입력 트래픽**: 물리적 스위치에서 설정된 로드 밸런싱 정책에 따라 제어된다.

3. **장애 조치(Failover) 설정**

​	•	**Active(활성 NIC)**: 기본적으로 사용되는 NIC.

​	•	**Standby(대기 NIC)**: Active NIC에 장애가 발생하면 자동으로 트래픽을 처리하는 NIC.

​	•	**Unused(미사용 NIC)**: 네트워크 트래픽을 처리하지 않으며, 필요 시 Active 또는 Standby 그룹으로 이동 가능.

**NIC 팀 구성 및 장애 조치 예시**

​	•	**예제 1**: 두 개의 NIC가 Active 상태로 설정된 경우, 트래픽은 두 개의 NIC로 나누어 전송된다.

​	•	**예제 2**: Active NIC가 장애가 발생하면, Standby NIC가 자동으로 트래픽을 처리한다.

**결론**



NIC 팀 구성과 장애 조치는 **네트워크 가용성을 높이고, 트래픽을 효율적으로 분산하는 핵심적인 네트워크 관리 기능**이다.

가상 환경에서는 **가용성을 극대화하고 네트워크 성능을 유지하기 위해** 반드시 설정해야 하는 기능 중 하나이다.

------

## **출발지 가상 포트 ID 기반 로드 밸런싱 (Originating Virtual Port ID)**

![image-20250304153324334](/assets/cisco_post_img/2025-03-04- Module 5-2 Lesson 2 Virtual Switch Networking Policies//image-20250304153324334.png)

출발지 가상 포트 ID 기반 로드 밸런싱은 가상 머신(VM)의 트래픽을 특정 **물리적 NIC(Uplink)** 에 고정적으로 매핑하는 방식이다.

가상 스위치(Virtual Switch)는 **VM이 연결된 가상 포트(Virtual Port ID)를 기준으로** 어느 물리적 NIC을 사용할지 결정한다.

**1. 동작 방식**

​	1.	**VM이 가상 스위치에 연결될 때, 특정 포트 ID가 할당됨.**

​	•	예를 들어, VM1이 “가상 포트 #3”에 연결되면, 가상 스위치는 이를 기반으로 업링크를 선택한다.

​	2.	**선택된 업링크(물리 NIC)가 해당 VM의 트래픽을 처리함.**

​	•	가상 포트 ID가 같은 한, 해당 VM의 모든 트래픽은 동일한 업링크로 전달된다.

​	3.	**다른 VM이 추가될 경우, 새로운 포트 ID가 부여되고, 또 다른 업링크로 매핑될 수 있음.**

​	•	하지만, 트래픽 부하 상태와 무관하게 특정 포트 ID는 고정된 업링크에 연결된다.

**2. 장점**



**① 간단한 구현과 낮은 오버헤드**

​	•	VMkernel이 **프레임을 분석할 필요 없이** 빠르게 업링크를 결정할 수 있음.

​	•	업링크 결정은 보통 VM이 처음 연결될 때 한 번만 수행되므로 **성능 부담이 적음**.



**② 균형 잡힌 트래픽 배분 (다수의 VM이 있을 경우)**

​	•	**가상 NIC(VNIC) 수가 물리 NIC(PNIC)보다 많으면 트래픽이 자연스럽게 분산됨**.

​	•	예를 들어, 4개의 VM이 있고 2개의 업링크가 있다면, 각 업링크는 대략 2개의 VM을 담당하게 됨.



**③ 물리적 스위치 변경 불필요**

​	•	**LACP(Link Aggregation Control Protocol) 또는 IP 해시 기반 설정이 필요 없음.**

​	•	물리적 스위치에서 **트렁킹(Trunking) 설정을 하지 않아도** 사용할 수 있음.

​	•	단순한 네트워크 구성에서도 적용이 가능하여, 관리가 편리함.

**3. 단점**



**① 트래픽 부하를 고려하지 않음**

​	•	트래픽이 업링크 간에 자동으로 재분배되지 않음.

​	•	한 개의 업링크가 과부하 상태에 놓여도, 해당 업링크에 매핑된 VM은 계속 해당 NIC을 사용함.



**② 대역폭 제한**

​	•	**각 VM은 할당된 단일 업링크의 대역폭까지만 사용 가능함.**

​	•	예를 들어, 업링크 NIC의 속도가 1Gbps라면, 하나의 VM은 최대 1Gbps까지만 사용 가능.

​	•	여러 개의 가상 NIC를 사용하는 VM만이 **다중 업링크의 대역폭을 활용할 수 있음**.



**③ 특정 환경에서는 트래픽 불균형 발생 가능**

​	•	예를 들어, 3개의 VM이 있고 2개의 업링크가 있다면, 한 업링크는 1개의 VM을 담당하고, 다른 업링크는 2개의 VM을 담당할 수 있음.

​	•	이 경우, **한쪽 NIC가 다른 NIC보다 더 많은 부하를 받을 가능성이 있음**.



**결론**



출발지 가상 포트 ID 기반 로드 밸런싱은 **간단하고 빠른 트래픽 분배 방법**이지만, **업링크 부하를 고려하지 않는다는 점이 단점**이다.

트래픽이 일정한 환경에서는 유용하지만, 트래픽 부하가 변동이 심하거나, 특정 VM이 높은 대역폭을 요구하는 경우에는 **다른 로드 밸런싱 방식(IP 해시 기반, MAC 해시 기반 등)을 고려해야 할 수도 있음**.

------

------

## **출발지 MAC 해시 기반 로드 밸런싱 (Source MAC Hash)**

![image-20250304154003930](/assets/cisco_post_img/2025-03-04- Module 5-2 Lesson 2 Virtual Switch Networking Policies//image-20250304154003930.png)

출발지 MAC 해시 기반 로드 밸런싱은 **가상 머신(VM)의 가상 NIC(Virtual NIC, vNIC)의 MAC 주소를 기반으로 물리적 NIC(Uplink)를 선택하는 방식**이다.

가상 스위치(Virtual Switch)는 **VM의 MAC 주소를 해시(Hash) 연산하여 특정 물리적 NIC에 트래픽을 전달**한다.

**1. 동작 방식**

​	1.	**각 가상 NIC(vNIC)는 고유한 MAC 주소를 가짐.**

​	2.	**가상 스위치는 이 MAC 주소를 해시(Hash) 알고리즘을 사용하여 특정 물리적 NIC(Uplink)를 선택.**

​	3.	**해당 NIC는 VM의 모든 트래픽을 처리함.**

​	4.	**VM이 종료되거나 다시 시작하더라도 동일한 MAC 주소를 사용하면 같은 Uplink가 계속 사용됨.**

**2. 장점**



**① 단순한 설정, 별도의 물리적 스위치 변경 불필요**

​	•	물리적 스위치에서 **LACP(Link Aggregation Control Protocol) 또는 해시 기반 설정이 필요 없음.**

​	•	네트워크 관리자 개입 없이 손쉽게 적용할 수 있음.



**② VM이 동일한 Uplink를 지속적으로 사용 가능**

​	•	VM을 **종료하거나 재시작해도 동일한 MAC 주소를 가지므로** 같은 물리적 NIC을 사용함.

​	•	**일관된 네트워크 경로를 유지**할 수 있어 예측 가능한 트래픽 흐름을 제공.



**③ 모든 스위치와 호환 가능**

​	•	특수한 기능이 필요하지 않아 **모든 네트워크 환경에서 적용 가능**.

**3. 단점**



**① 대역폭 제한**

​	•	VM의 트래픽은 하나의 MAC 주소를 기반으로 하나의 물리적 NIC에만 할당됨.

​	•	**VM이 1개의 vNIC만 사용하는 경우, 최대 사용 가능한 대역폭은 해당 NIC의 속도(예: 1Gbps)로 제한됨.**

​	•	단일 vNIC를 사용하는 VM은 **멀티 업링크를 활용하지 못함**.



**② 로드 밸런싱의 비효율성**

​	•	가상 스위치는 업링크의 부하를 고려하지 않음.

​	•	MAC 주소 해시 값이 특정 업링크에 집중될 수 있어 **일부 업링크는 과부하, 일부 업링크는 저부하 상태가 될 수 있음.**

​	•	트래픽이 균등하게 분배되지 않을 가능성이 있음.



**③ 해시 계산으로 인한 성능 오버헤드**

​	•	**출발지 가상 포트 ID 기반 로드 밸런싱보다 연산 부담이 큼.**

​	•	출발지 MAC 해시 기반 방식은 **각 패킷마다 업링크를 재계산**해야 하므로 성능 오버헤드가 발생할 수 있음.

**결론**



출발지 MAC 해시 기반 로드 밸런싱은 **간단한 로드 밸런싱 방식으로 설정이 용이하며, 모든 네트워크 환경에서 호환 가능**하다.

하지만, **트래픽 부하를 고려하지 않고, 하나의 NIC에만 트래픽을 집중시키는 특성으로 인해 대역폭 활용이 비효율적일 수 있다**.

특히, 높은 네트워크 성능이 필요한 환경에서는 **다른 로드 밸런싱 방식(예: IP 해시 기반 로드 밸런싱, LACP 등)을 고려하는 것이 바람직함.**

------

------

## **출발지 및 목적지 IP 해시 기반 로드 밸런싱 (Source and Destination IP Hash)**

![image-20250304154259817](/assets/cisco_post_img/2025-03-04- Module 5-2 Lesson 2 Virtual Switch Networking Policies//image-20250304154259817.png)





출발지 및 목적지 IP 해시 기반 로드 밸런싱은 **각 패킷의 출발지(Source) 및 목적지(Destination) IP 주소를 기반으로 물리적 NIC(Uplink)를 선택하는 방식**이다.

이 방식은 **여러 개의 물리적 NIC를 하나의 논리적 링크로 묶는 링크 집계(Link Aggregation)를 지원하는 환경에서 사용 가능**하다.

**1. 동작 방식**

​	1.	**각 패킷의 출발지 및 목적지 IP 주소를 확인.**

​	2.	**해당 IP 주소들을 해시(Hash) 연산하여 특정 물리적 NIC(Uplink)를 선택.**

​	3.	**같은 출발지-목적지 IP 조합을 가진 패킷은 동일한 NIC로 전송.**

​	4.	**다른 IP 조합을 가진 패킷은 다른 NIC를 통해 전송되어 트래픽이 분산됨.**

**2. 필요 조건**



이 방식은 **일반적인 스위치 환경에서 사용 불가능**하며, 반드시 **링크 집계(Link Aggregation) 또는 EtherChannel**을 지원해야 한다.

​	•	**IEEE 802.3ad LACP(Link Aggregation Control Protocol) 지원 필요**

​	•	여러 개의 물리적 링크를 하나의 논리적 채널로 묶어 **대역폭 증가 및 이중화 제공**.

​	•	LACP를 사용하면 스위치가 연결된 포트 상태를 자동으로 관리할 수 있음.

​	•	**Cisco EtherChannel 사용 가능**

​	•	EtherChannel은 **Cisco 스위치에서 사용하는 포트 트렁킹(Port Trunking) 기술**.

​	•	여러 개의 물리적 이더넷 링크를 하나의 논리적 이더넷 링크로 묶어 **고가용성 및 고속 연결을 제공**.

**3. 장점**



**① 트래픽이 보다 균등하게 분배됨**

​	•	출발지 및 목적지 IP 조합을 기반으로 **각 패킷이 다른 NIC로 전달될 가능성이 높음**.

​	•	출발지 MAC 해시(Source MAC Hash) 및 출발지 가상 포트 기반(Originating Virtual Port ID) 방식보다 **트래픽이 골고루 분배될 확률이 높음**.



**② VM이 여러 개의 물리 NIC 대역폭을 활용 가능**

​	•	**다중 IP 주소와 통신하는 VM은 여러 NIC를 활용할 수 있어 더 높은 처리량(Throughput) 가능**.

​	•	단일 NIC 기반 VM도 목적지 IP가 다를 경우 **멀티 NIC로 트래픽이 분산될 가능성 있음**.

**4. 단점**



**① 높은 연산 오버헤드**

​	•	**가상 스위치가 각 패킷마다 출발지 및 목적지 IP를 기반으로 Uplink를 계산해야 함**.

​	•	기존 방식(출발지 가상 포트 기반, MAC 해시 기반)보다 **연산량이 많아 성능에 영향을 미칠 가능성 있음**.



**② 물리 스위치 설정 변경 필요**

​	•	기본적으로 **LACP(802.3ad) 또는 EtherChannel을 활성화해야 함**.

​	•	네트워크 관리자가 **물리적 스위치에서 LAG(Link Aggregation Group) 구성을 직접 설정해야 함**.

​	•	**기본 스위치 환경에서는 사용할 수 없음**.



**③ 복잡한 문제 해결 과정**

​	•	이 방식은 트래픽이 특정 NIC에서 들어오고, 다른 NIC에서 나갈 수 있어 **트래픽 흐름을 추적하고 문제를 해결하는 것이 어려움**.

​	•	**패킷이 어느 NIC를 통해 들어오고 나가는지 명확하게 분석하기 어려울 수 있음**.

**결론**



출발지 및 목적지 IP 해시 기반 로드 밸런싱은 **고성능 네트워크 환경에서 멀티 NIC의 활용도를 극대화할 수 있는 방식**이다.

하지만, **물리 스위치의 설정이 필요하며, 연산 오버헤드가 높고 문제 해결이 어렵다는 단점이 있다**.

따라서, **고급 네트워크 설정이 가능한 환경에서는 유용하지만, 일반적인 환경에서는 적합하지 않을 수 있다**.

------

------

## **네트워크 장애 감지 및 처리 (Detecting and Handling Network Failure)**

![image-20250304154904631](/assets/cisco_post_img/2025-03-04- Module 5-2 Lesson 2 Virtual Switch Networking Policies//image-20250304154904631.png)

ESXi의 VMkernel은 **네트워크 장애를 감지하고 처리**하는 역할을 한다.

VMkernel은 **물리적 네트워크 어댑터(NIC)의 상태를 모니터링**하며, 네트워크 장애가 발생하면 **적절한 페일오버(Failover) 및 장애 복구(Failback)를 수행**한다.

**1. 네트워크 장애 감지 방식**

VMkernel은 **네트워크 연결 상태를 1초 간격으로 확인**하며, 네트워크 장애를 감지하는 방법은 두 가지가 있다.

**① Link Status Only (링크 상태만 확인)**

​	•	**물리적 NIC의 링크 상태만 확인하여 장애를 감지**하는 방식.

​	•	**NIC의 물리적 연결이 끊어졌는지 여부**만 판단 가능.

​	•	가장 간단한 방식이지만, **상위 네트워크 경로 문제(예: 스위치 장애)는 감지 불가**.



**② Beacon Probing (비컨 탐색)**

​	•	**다수의 NIC를 사용하는 환경에서 추가적인 장애 감지를 수행하는 방식**.

​	•	**NIC에서 신호(Beacon)를 전송하고, 다른 NIC가 이를 수신하는 방식으로 네트워크 경로 상태를 확인**.

​	•	스위치 장애 등 물리적 링크가 끊어지지 않은 장애(예: 특정 경로 트래픽 차단)도 감지 가능.

​	•	**NIC가 하나뿐인 환경에서는 사용할 수 없음**.



------

**2. 네트워크 장애 처리 방식**

네트워크 장애가 감지되면, **VMkernel은 다음과 같은 방식으로 장애를 처리**한다.



**① Notify Switches (스위치 알림)**

​	•	**MAC 주소의 물리적 위치 변경을 스위치에 알림**.

​	•	기존 NIC 장애 발생 후 **페일오버된 NIC에서 새로운 MAC 주소를 사용해야 할 경우 유용**.

​	•	기본적으로 **“Yes” 설정을 권장**하여 빠른 네트워크 경로 복구가 가능하도록 설정.



**② Failover (페일오버)**

​	•	**장애가 발생한 NIC를 비활성화하고, 대체 NIC(Standby Adapter)로 트래픽을 전환**.

​	•	Failover 방식은 **Load Balancing 정책 및 Failover Order 설정에 따라 다르게 동작**.



**③ Failback (페일백)**

​	•	**장애가 복구된 후, 원래 사용하던 NIC로 다시 전환할지 여부를 결정**.

​	•	**“Yes” 설정 시**: 원래 NIC가 복구되면 자동으로 다시 활성화됨.

​	•	**“No” 설정 시**: 관리자가 수동으로 NIC를 다시 활성화해야 함.

------

**3. 로드 밸런싱 및 페일오버 정책**



네트워크 장애 발생 시, **어떤 방식으로 트래픽을 분배하고 대체할지를 결정하는 로드 밸런싱 및 페일오버 정책이 중요**하다.



**① Load Balancing (로드 밸런싱)**

​	•	NIC 팀(Team)에서 **트래픽을 어떻게 분배할지 결정**하는 방식.

​	•	선택 가능한 로드 밸런싱 옵션:

​	•	**Use explicit failover order**: **설정된 순서대로 NIC를 사용**.

​	•	**Route based on originating virtual port**: **가상 포트 ID를 기반으로 트래픽 분배**.

​	•	**Route based on source MAC hash**: **출발지 MAC 주소를 기반으로 트래픽 분배**.

​	•	**Route based on IP hash**: **출발지 및 목적지 IP 주소를 기반으로 트래픽 분배** (LACP 필요).



**② Failover Order (페일오버 순서)**

​	•	NIC의 역할을 다음과 같이 분류하여 **페일오버 발생 시 활성화할 NIC를 결정**.

​	•	**Active adapters (활성 NIC)**: 기본적으로 트래픽을 처리하는 NIC.

​	•	**Standby adapters (대기 NIC)**: Active NIC 장애 발생 시 트래픽을 처리할 NIC.

​	•	**Unused adapters (미사용 NIC)**: 절대 사용되지 않는 NIC.

------

**결론**

​	•	VMkernel은 **네트워크 장애를 감지하고, Failover/Fallback을 수행하여 서비스 지속성을 유지**함.

​	•	**장애 감지 방식(Link Status Only vs Beacon Probing)**을 환경에 맞게 선택해야 함.

​	•	**Failover 및 Load Balancing 설정을 적절히 구성하여 장애 발생 시 신속한 복구가 가능하도록 조정**해야 함.

------

------

## **물리 네트워크 고려 사항 (Physical Network Considerations)**



vSphere 가상 네트워크 환경은 **기본적으로 물리 네트워크 인프라에 의존**한다.

따라서, vSphere 관리자는 **네트워크 팀과 협력하여 네트워크 요구 사항을 논의하고, 물리 네트워크 구성과의 연계를 고려**해야 한다.

------

**1. 논의해야 할 주요 네트워크 요소**

가상 네트워크의 안정성과 성능을 보장하기 위해, 다음과 같은 요소를 검토해야 한다.



**① 물리적 스위치 개수 (Number of Physical Switches)**

​	•	**하나의 물리적 스위치만 사용할 경우, 장애 발생 시 전체 네트워크가 다운될 위험**이 있음.

​	•	**이중화(Redundancy)** 및 **로드 밸런싱(Load Balancing)을 위해 여러 개의 물리적 스위치를 구성**하는 것이 권장됨.



**② 필요한 네트워크 대역폭 (Network Bandwidth Required)**

​	•	**vMotion, 스토리지 네트워크(iSCSI/NFS), 관리 트래픽, VM 트래픽 등 다양한 네트워크 트래픽을 고려하여 충분한 대역폭을 확보**해야 함.

​	•	**NIC 팀(NIC Teaming) 및 로드 밸런싱을 통해 네트워크 성능을 최적화**할 수 있음.



**③ 물리적 스위치의 VLAN 태깅 지원 (Physical Switch VLAN Tagging: 802.1Q)**

​	•	**802.1Q 프로토콜을 지원하는지 확인해야 하며, VLAN을 통한 네트워크 분리가 필요한 경우 스위치에서 Trunk 포트를 설정**해야 함.

​	•	VLAN 태깅 방식:

​	•	**External Switch Tagging (EST)**: VLAN을 물리적 스위치에서 관리.

​	•	**Virtual Switch Tagging (VST)**: ESXi의 가상 스위치에서 VLAN 태깅을 관리.

​	•	**Virtual Guest Tagging (VGT)**: VM 내부에서 VLAN 태깅을 수행.



**④ NIC 팀 구성 및 Link Aggregation 지원 여부**

​	•	**NIC 팀 구성 시, 물리적 스위치가 802.3ad(Link Aggregation) 또는 EtherChannel을 지원하는지 확인**해야 함.

​	•	**지원 가능한 Link Aggregation 방식**:

​	•	**802.3ad (LACP, Link Aggregation Control Protocol)**: 동적 NIC 결합을 지원하는 표준 프로토콜, 이더 채널로 묶는 것

​	•	**EtherChannel**: Cisco에서 제공하는 포트 트렁킹 기술.

​	•	**Static NIC Teaming**: 스위치 설정 없이 ESXi에서만 NIC를 팀으로 묶는 방식.



**⑤ 네트워크 포트 보안 (Network Port Security)**

​	•	**MAC 스푸핑(MAC Spoofing) 방지 및 네트워크 무단 접근을 막기 위해 포트 보안 정책을 설정해야 함**.

​	•	주요 보안 설정:

​	•	**포트 보안(Port Security) 활성화**: 특정 MAC 주소만 허용.

​	•	**DHCP 스누핑(DHCP Snooping) 적용**: 불법 DHCP 서버 차단.

​	•	**IP 소스 가드(IP Source Guard) 사용**: 특정 IP만 허용.



**⑥ LLDP 및 CDP 설정 (Link Layer Discovery Protocol & Cisco Discovery Protocol)**

​	•	**네트워크 디바이스 간 연결 정보를 자동으로 검색하고 관리할 수 있도록 LLDP/CDP를 적절히 설정**해야 함.

​	•	LLDP/CDP 운영 모드:

​	•	**Listen (수신 모드)**: 상대방의 장비 정보를 수신.

​	•	**Broadcast (전송 모드)**: 자신의 장비 정보를 네트워크에 알림.

​	•	**Listen and Broadcast (양방향 모드)**: 정보를 수신하고 전송.

​	•	**Disabled (비활성화)**: LLDP/CDP 기능을 사용하지 않음.

**2. 결론**

​	•	**가상 네트워크의 성능과 안정성을 유지하려면, 물리적 네트워크 인프라와의 조율이 필수적**이다.

​	•	**VLAN, NIC 팀 구성, 포트 보안, Link Aggregation, LLDP/CDP 설정 등을 사전에 검토하고 네트워크 팀과 협의하여 최적의 환경을 구축**해야 한다.

**기타**

- vPC: virtual port channel (NX-OS) 하나의 장비에서 서로 다른 연결된 곳에 채널링이 가능하다.
- cisco Nexus switch
---
title: <h0>VMware NSX Module 2-2 VMware Virtual Cloud Network and VMware NSX</h0>
author: cotes   
categories: [cisco virtual cloud,2025-03-14-cisco]
tags: [Network, Cloud]
---

# VMware NSX Module 2-2



------

## **NSX 정책(Policy Role)의 역할과 기능**

![image-20250314173009936](/assets/cisco_post_img/2025-03-13-VMware NSX Module 2-2//image-20250314173009936.png)

NSX에서 **정책 역할(Policy Role)** 은 네트워크 및 보안 구성을 효율적으로 관리하고 일관성을 유지하기 위한 핵심 요소임.



**1. 주요 기능**

​	•	**중앙 집중식 관리**: 네트워킹 및 보안 구성을 중앙에서 일괄 관리 가능

​	•	**사용자 친화적 인터페이스**: NSX UI에서 직관적인 설정 입력 지원

​	•	**의도 기반 네트워크 운영**: 현재 상태와 관계없이 **최종적으로 원하는 상태**를 정의하여 자동 적용 가능



**2. 정책 기반 관리의 장점**

​	•	**단순화된 운영**: 사용자는 복잡한 내부 구현을 신경 쓸 필요 없이 최종 목표만 정의하면 됨

​	•	**자동화 및 확장성**: 네트워크 변경 사항이 자동으로 적용되며, 대규모 환경에서도 유연하게 확장 가능

​	•	**일관된 정책 적용**: 동일한 보안 및 네트워크 규칙을 전체 인프라에 일괄 배포 가능



------



**NSX 정책 역할은 네트워크 및 보안 관리를 중앙 집중화하고, 사용자가 원하는 목표 상태를 설정하면 이를 자동으로 적용하여 운영을 단순화하는 기능을 제공함.**



------

------



## **NSX 매니저(NSX Manager)의 역할과 기능**

![image-20250314172855243](/assets/cisco_post_img/2025-03-13-VMware NSX Module 2-2//image-20250314172855243.png)

NSX Manager는 NSX 인프라를 관리하고 제어하는 핵심 구성 요소로, **데이터 플레인 및 정책을 연결하는 역할**을 수행함.



**1. 주요 기능**

​	•	**데이터 플레인 설치 및 준비**: NSX Manager는 NSX Edge, 호스트, 그리고 기타 구성 요소를 설정하고, 데이터 플레인이 동작할 수 있도록 준비함.

​	•	**NSX 정책 수신 및 검증**: 사용자가 설정한 정책을 수신하여, 구성이 유효한지 검토한 후 처리함.

​	•	**설정 배포(Publish)**: 검증된 설정을 **중앙 제어 플레인(CCP, Central Control Plane)** 으로 배포하여 전체 네트워크에 적용함.

​	•	**데이터 플레인 통계 수집**: NSX Manager는 **데이터 플레인에서 네트워크 상태 및 성능 정보를 수집**하여 운영자가 모니터링할 수 있도록 지원함.



**2. NSX Manager의 중요성**

​	•	**네트워크 자동화**: 사용자가 설정한 정책을 자동으로 배포하여, 수동 구성 없이 일관된 네트워크 환경을 유지할 수 있음.

​	•	**확장성 지원**: 여러 개의 NSX Manager 노드가 클러스터를 이루어 대규모 환경에서도 고가용성을 유지할 수 있음.

​	•	**보안 및 운영 관리**: 정책을 일괄 적용하여 네트워크 보안 설정을 강화하고, 실시간 운영 데이터를 바탕으로 문제를 진단할 수 있음.



------



**NSX Manager는 NSX의 핵심 관리 요소로, 데이터 플레인과 제어 플레인 간의 원활한 연결을 보장하며, 네트워크 및 보안 정책을 일관되게 적용하는 중요한 역할을 수행함.**

------

------

## **NSX Policy and NSX Manager Workflow (NSX 정책 및 NSX 매니저 워크플로우)**



NSX Manager 노드의 주요 구성 요소들은 **서로 연계하여 네트워크 및 보안 정책을 설정하고 관리**함.



1. **주요 구성 요소 및 역할**

   * **Reverse Proxy**
     * NSX Manager의 **진입점 역할** 수행
     * 인증(Authentication) 및 권한 부여(Authorization) 기능 제공

   * **NSX Manager UI**
     * 사용자가 네트워크 및 보안 정책을 관리하는 인터페이스
     * 정책 기반 네트워크 설정 가능

   * **Policy 역할**
     * 네트워크 및 보안 정책을 중앙에서 관리하고 **관리자 역할(Manager Role)에 정책을 적용**
     * 설정된 정책을 기반으로 네트워크 동작을 조정

​	•	**Proton (핵심 컴포넌트)**

​	•	**논리적 스위칭, 논리적 라우팅, 분산 방화벽 관리** 기능 수행

​	•	NSX Manager 내 **핵심 운영 엔진** 역할

​	•	**CorfuDB (데이터 저장소)**

​	•	**NSX Policy 및 Proton의 데이터 저장소** 역할

​	•	**메모리 기반 분산 트랜잭션 로그 저장소**로 높은 성능과 확장성 제공

​	•	각 트랜잭션을 공유 트랜잭션 로그 파일에 기록하여 영속성을 유지

​	•	빠른 쿼리 응답을 위해 메모리에서 직접 데이터 제공



------



2. **NSX 정책 적용 과정**

   1. **사용자가 Reverse Proxy를 통해 NSX Manager UI에 접근**

   2. **NSX 정책(Policy) 엔진이 네트워크 및 보안 정책을 정의**

   3. **Proton이 정책을 기반으로 네트워크 동작을 관리**

   4. **NSX Policy와 Proton의 데이터는 CorfuDB에 저장됨**

   5. **관리 정책이 적용된 네트워크 환경이 운영됨**



------



**3. NSX 정책 및 Proton의 핵심 기능 요약**

| **구성 요소**  | **주요 역할**                                 |
| -------------- | --------------------------------------------- |
| Reverse Proxy  | 사용자 요청을 처리하고 인증 및 권한 부여 수행 |
| NSX Manager UI | 정책 및 네트워크 관리 인터페이스 제공         |
| Policy 역할    | 네트워크 및 보안 정책을 설정하고 적용         |
| Proton         | 네트워크 기능(스위칭, 라우팅, 방화벽) 관리    |
| CorfuDB        | 고성능 분산 데이터 저장소 역할 수행           |





------

**4. 결론**

NSX Manager는 **정책 중심의 네트워크 운영을 가능하게 하며**, Reverse Proxy, Policy 엔진, Proton, CorfuDB가 **서로 유기적으로 작동하여 네트워크 및 보안 정책을 효과적으로 적용**함.

------

------

## **NSX 컨트롤러 역할(NX Controller Role)**

![image-20250314173521671](/assets/cisco_post_img/2025-03-13-VMware NSX Module 2-2//image-20250314173521671.png)

NSX 컨트롤러는 **네트워크 및 보안 정책의 실현된 상태를 유지하고 데이터 플레인을 구성하는 역할**을 수행함.



------



1. **NSX 컨트롤러의 주요 기능**

   1. **제어 플레인(Control Plane) 기능 제공**
      * 논리적 스위칭(Logical Switching)
      * 논리적 라우팅(Logical Routing)
      * 분산 방화벽(Distributed Firewall)

   2. **런타임 상태(Run-Time State) 계산**
      * 관리 플레인(Management Plane)에서 받은 설정을 바탕으로 **실시간 상태 정보** 계산

   3. **데이터 플레인(Forwarding Plane) 정보 관리**
      * 데이터 플레인 요소에서 보고된 **네트워크 토폴로지 정보 수집 및 배포**
      * 동적으로 변경되는 네트워크 상태를 반영

   4. **무상태(Stateless) 설정을 전달**
      * NSX 환경 내 **패킷 전송을 수행하는 포워딩 엔진(Forwarding Engines)에 설정 전달**
      * 필요할 때만 설정을 업데이트하여 **효율적인 리소스 사용 가능**



------

**2. NSX 컨트롤러의 핵심 역할**

| **기능**               | **설명**                                         |
| ---------------------- | ------------------------------------------------ |
| 네트워크 토폴로지 관리 | 데이터 플레인 요소에서 보고된 정보 수집 및 배포  |
| 논리적 네트워크 설정   | 스위칭, 라우팅, 방화벽 정책을 구성하고 적용      |
| 런타임 상태 유지       | 실시간 네트워크 상태를 계산하고 반영             |
| 패킷 포워딩 엔진 구성  | 무상태 설정을 전달하여 최적화된 트래픽 경로 유지 |





------



**3. NSX 컨트롤러 작동 방식**

​	1.	**NSX 관리 플레인(Management Plane)이 정책을 설정**

​	2.	**NSX 컨트롤러가 정책을 분석하고 데이터 플레인 요소로 전달**

​	3.	**NSX 컨트롤러가 네트워크 상태를 지속적으로 모니터링하고 업데이트**

​	4.	**데이터 플레인은 컨트롤러의 지시에 따라 패킷을 처리**



------

**4. 결론**

NSX 컨트롤러는 **네트워크의 실시간 상태를 관리하고 최적화된 정책을 데이터 플레인으로 전달하는 핵심 역할**을 수행함.

이를 통해 **효율적인 네트워크 운영과 보안 정책 적용이 가능**함.

------

------

## **NSX 컨트롤 플레인의 샤딩(Sharding) 기능**



NSX 관리 클러스터는 **세 개의 NSX 중앙 컨트롤 플레인(CCP) 노드**로 구성됨.

컨트롤 플레인은 **샤딩(Sharding) 기법**을 활용하여 워크로드를 분산 처리함.



------



**1. NSX 컨트롤 플레인의 샤딩(Sharding) 개념**

​	•	**샤딩(Sharding) 기법**을 사용하여 각 컨트롤러에 네트워크 작업을 분배함.

​	•	각 **전송 노드(Transport Node)**는 하나의 컨트롤러에 할당됨.

​	•	컨트롤러는 **L2 및 L3 설정, 분산 방화벽 규칙 배포 역할 수행**.

​	•	컨트롤러는 **할당된 노드에 대한 정보만 유지**하고 관리 플레인 및 데이터 플레인에서 업데이트를 수신함.



------



2. **NSX 컨트롤러 샤딩(Sharding) 동작 방식**

   1. **NSX 관리 플레인(Management Plane)에서 설정 변경**
      * NSX 관리자는 네트워크 정책을 구성하고 적용함.
      * 관리 플레인은 설정을 컨트롤 플레인(CCP)으로 전달함.

   2. **컨트롤 플레인(CCP)이 설정을 샤딩(Sharding)하여 분배**
      * 각 컨트롤러는 특정 전송 노드(Transport Node)의 L2, L3 설정 및 방화벽 정책을 유지함.
      * 컨트롤러 간에 중복 데이터가 저장되지 않고, **자신이 관리하는 노드의 정보만 유지**하여 리소스를 최적화함.

   3. **컨트롤러가 데이터 플레인(Forwarding Plane)으로 설정을 배포**
      * 컨트롤러는 할당된 전송 노드에 대한 설정을 배포함.
      * 전송 노드는 컨트롤러에서 받은 설정을 기반으로 **패킷 포워딩 및 방화벽 정책을 실행**함.



------



**3. NSX 컨트롤 플레인의 샤딩(Sharding) 장점**

| **특징**                        | **설명**                                                    |
| ------------------------------- | ----------------------------------------------------------- |
| **워크로드 분산**               | 여러 컨트롤러가 개별 노드를 관리하여 성능 향상              |
| **리소스 최적화**               | 각 컨트롤러가 자신이 관리하는 노드의 데이터만 유지          |
| **확장성(Scalability)**         | 샤딩을 통해 대규모 네트워크에서도 확장 가능                 |
| **고가용성(High Availability)** | 특정 컨트롤러 장애 발생 시 다른 컨트롤러가 역할을 인계 가능 |





------



**4. 결론**



NSX 컨트롤 플레인은 **샤딩(Sharding) 기법을 활용하여 네트워크 및 보안 정책을 효과적으로 분산 관리**함.

이를 통해 **워크로드를 최적화하고, 리소스 사용량을 줄이며, 확장성을 높이는 역할**을 수행함.

------

------

## **NSX 컨트롤러 장애 관리 (Controller Failure Handling)**

![image-20250314173909689](/assets/cisco_post_img/2025-03-13-VMware NSX Module 2-2//image-20250314173909689.png)

NSX 환경에서 **컨트롤러 노드 중 하나가 장애(Failure) 발생 시**, 시스템은 **자동으로 워크로드를 재분배**하여 고가용성을 유지함.



------



1. **컨트롤러 장애 시 주요 동작**

   * **샤딩 테이블(Sharding Table)이 재계산(Recalculated)**
     * 장애가 발생한 컨트롤러가 관리하던 워크로드를 남은 컨트롤러 노드로 자동 재배치함.
     * 이를 통해 컨트롤러 장애가 발생해도 네트워크 및 보안 정책 적용이 지속됨.

   * **고가용성(High Availability) 및 이중 활성화 방지(Dual-Active Prevention)**
     * 컨트롤러 장애 시, **나머지 컨트롤러가 장애 감지 후 자동으로 역할을 재분배**하여 단일 장애 지점을 제거함.
     * 이중 활성화(Dual-Active) 문제를 방지하기 위해 **샤딩 테이블을 동적으로 업데이트**하여 기존 역할을 재분배함.

   * **데이터 플레인(Traffic Forwarding) 영향 없음**
     * 컨트롤러는 **제어 플레인(Control Plane) 역할**을 수행하지만, 실제 패킷 포워딩은 **데이터 플레인(Data Plane)**에서 처리됨.
     * 따라서, 컨트롤러 장애 발생 시에도 **데이터 플레인의 트래픽 흐름은 영향을 받지 않음**.



------



2. **장애 감지 및 복구 과정**

   1. **컨트롤러 장애 감지(Controller Failure Detection)**
      * 관리 플레인(Management Plane)이 주기적으로 컨트롤러의 상태를 모니터링함.
      * 특정 컨트롤러가 응답하지 않으면 장애로 감지됨.

   2. **샤딩 테이블 재계산(Recalculate Sharding Table)**
      * 남아있는 컨트롤러 노드가 자동으로 장애 컨트롤러의 역할을 가져옴.
      * 샤딩 테이블이 업데이트되어 **기존 전송 노드(Transport Node)**의 할당이 변경됨.

   3. **재분배 후 네트워크 안정화(Stabilization of Network State)**
      * 변경된 네트워크 및 방화벽 규칙이 남아있는 컨트롤러를 통해 다시 적용됨.
      * 새로운 컨트롤러 노드가 추가될 경우, **샤딩 테이블이 다시 업데이트됨**.



------



**3. NSX 컨트롤러 장애 관리의 장점**

| **특징**                             | **설명**                                                     |
| ------------------------------------ | ------------------------------------------------------------ |
| **자동 복구(Self-Healing)**          | 컨트롤러 장애 발생 시 자동으로 남은 컨트롤러가 워크로드를 재분배 |
| **고가용성(High Availability) 보장** | 컨트롤러 장애로 인한 네트워크 운영 중단 방지                 |
| **데이터 플레인 영향 없음**          | 트래픽 포워딩에는 영향을 미치지 않음                         |
| **이중 활성화 방지**                 | 하나의 워크로드가 중복 처리되지 않도록 보장                  |





------



**4. 결론**



NSX 컨트롤러 중 하나가 장애 발생해도 **남아있는 컨트롤러가 자동으로 역할을 재분배하여 네트워크 가용성을 유지**함.

데이터 플레인의 트래픽은 **컨트롤러 장애와 무관하게 지속적으로 흐르며**, 관리 플레인은 샤딩 테이블을 업데이트하여 **자동 복구(Self-Healing) 기능을 제공**함.

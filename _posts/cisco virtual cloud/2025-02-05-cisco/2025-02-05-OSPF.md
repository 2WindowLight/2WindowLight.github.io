---
title: <h0>[Network] OSPF</h0>
author: cotes   
categories: [cisco virtual cloud, 2025-02-05-cisco]
tags: [Network]









---

## OSPF(Open Shortest Path First)

**OSPF(Open Shortest Path First)**ëŠ” **ë§í¬ ìƒíƒœ ë¼ìš°íŒ… í”„ë¡œí† ì½œ(Link-State Routing Protocol)**ë¡œ, **ë¼ìš°í„°ë“¤ì´ ë„¤íŠ¸ì›Œí¬ ì „ì²´ì˜ ìƒíƒœë¥¼ ê³µìœ í•˜ë©´ì„œ ìµœì ì˜ ê²½ë¡œë¥¼ ë™ì ìœ¼ë¡œ ê³„ì‚°í•˜ëŠ” í”„ë¡œí† ì½œ.**

OSPFëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ ì—ì–´ë¦¬ì–´ë¡œ êµ¬ë¶„í•œë‹¤.



**OSPF ì£¼ìš” íŠ¹ì§•**

â€‹	â€¢	**ë©”íŠ¸ë¦­(Cost)**: ëŒ€ì—­í­ ê¸°ì¤€ (ëŒ€ì—­í­ì´ ë†’ì„ìˆ˜ë¡ Costê°€ ë‚®ì•„ì§)

â€‹	â€¢	**ë¹ ë¥¸ ì»¨ë²„ì „ìŠ¤**: ë„¤íŠ¸ì›Œí¬ ë³€ê²½ ì‹œ ë¹ ë¥´ê²Œ ì—…ë°ì´íŠ¸

â€‹	â€¢	**ë¬´í•œ ë£¨í”„ ë°©ì§€**: RIPê³¼ ë‹¤ë¥´ê²Œ Loop-Free êµ¬ì¡°

â€‹	â€¢	**ë‹¤ì¤‘ ê²½ë¡œ ì§€ì›(ECMP)**: ê°™ì€ Costì˜ ê²½ë¡œê°€ ì—¬ëŸ¬ ê°œ ìˆì„ ê²½ìš° íŠ¸ë˜í”½ ë¶„ì‚°

â€‹	â€¢	**ë©€í‹°ì—ì–´ë¦¬ì–´(Multi-Area OSPF) ì§€ì›**: ë„¤íŠ¸ì›Œí¬ë¥¼ Area ë‹¨ìœ„ë¡œ êµ¬ë¶„í•˜ì—¬ í™•ì¥ì„± ì¦ê°€

![121213s](/Users/changhee/2WindowLight.github.io/_posts/images/2025-02-05-OSPF/121213s.png)

### R1

```bash
int lo 0
ip add 1.1.1.1 255.255.255.0
int e0/0
ip add 1.1.123.1 255.255.255.0
no sh
```



### R2

```bash
int lo 0
ip add 1.1.2.2 255.255.255.0
int e0/0
ip add 1.1.123.2 255.255.255.0
no sh
int e0/1
ip add 1.1.24.2 255.255.255.0
no sh
```



### R3

```bash
int lo 0
ip add 1.1.3.3 255.255.255.0
int e0/0
ip add 1.1.123.3 255.255.255.0
no sh
int e0/2
ip add 1.1.34.3 255.255.255.0
no sh
```



### R4

```bash
int lo 0
ip add 1.1.4.4 255.255.255.0
int e0/1
ip add 1.1.24.4 255.255.255.0
no sh
int e0/2
ip add 1.1.34.4 255.255.255.0
no sh
int e0/3
ip add 1.1.45.4 255.255.255.0
no sh
```



### R5

```bash
int lo 0
ip add 1.1.5.5 255.255.255.0
int e0/3
ip add 1.1.45.5 255.255.255.0
no sh
```

------

## ì •ë¦¬

ë„¤íŠ¸ì›Œí¬ë¥¼ ë³´ë©´, **R1 â†” Switch1 â†” R2, R3** ê°€ ì—°ê²°ë˜ê³ , **R2ì™€ R3ê°€ ê°ê° R4ì™€ ì—°ê²°**, ë§ˆì§€ë§‰ìœ¼ë¡œ **R4 â†” R5ê°€ ì—°ê²°**ë˜ì–´ ìˆë‹¤.

| ë¼ìš°í„° |                       ì¸í„°í˜ì´ìŠ¤ ì •ë³´                        |
| :----: | :----------------------------------------------------------: |
|   R1   |        e0/0 â†’ 1.1.123.1 (Switch1ì„ í†µí•´ R2, R3 ì—°ê²°)         |
|   R2   |   e0/0 â†’ 1.1.123.2 (R1ê³¼ ì—°ê²°), e0/1 â†’ 1.1.24.2 (R4 ì—°ê²°)    |
|   R3   |   e0/0 â†’ 1.1.123.3 (R1ê³¼ ì—°ê²°), e0/2 â†’ 1.1.34.3 (R4 ì—°ê²°)    |
|   R4   | e0/1 â†’ 1.1.24.4 (R2 ì—°ê²°), e0/2 â†’ 1.1.34.4 (R3 ì—°ê²°), e0/3 â†’ 1.1.45.4 (R5 ì—°ê²°) |
|   R5   |                  e0/3 â†’ 1.1.45.5 (R4 ì—°ê²°)                   |

------

ğŸ“Œ **ì˜ˆì œ**

â€‹	â€¢	**ì¶œë°œì§€:** R1

â€‹	â€¢	**ëª©ì ì§€:** R5

â€‹	â€¢	**ê²½ë¡œ:** R1 â†’ R2 â†’ R4 â†’ R5 ë˜ëŠ” R1 â†’ R3 â†’ R4 â†’ R5

â€‹	â€¢	OSPFëŠ” ë‘ ê°œì˜ ê²½ë¡œë¥¼ ë¹„êµí•´ì„œ **ìµœë‹¨ ê²½ë¡œë¥¼ ìë™ìœ¼ë¡œ ì„ íƒ**



ì‰½ê²Œ ì´í•´í•˜ëŠ” ì˜ˆì œ

|     êµ¬ë¶„     |              ì‹¤ì œ               |
| :----------: | :-----------------------------: |
|   ë„¤íŠ¸ì›Œí¬   |              ë„ë¡œ               |
|    ë¼ìš°í„°    |           ë„¤ë¹„ê²Œì´ì…˜            |
|     íŒ¨í‚·     |             ìë™ì°¨              |
|     OSPF     | ìµœì ì˜ ê²½ë¡œë¥¼ ê³„ì‚°í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ |
| SPF ì•Œê³ ë¦¬ì¦˜ |   ë„¤ë¹„ê²Œì´ì…˜ì˜ ê²½ë¡œ íƒìƒ‰ ê¸°ëŠ¥   |

**OSPFê°€ í•˜ëŠ” ì¼**

â€‹	â€¢	ë„¤íŠ¸ì›Œí¬ ì „ì²´ë¥¼ íŒŒì•…í•˜ê³ , **Dijkstra ì•Œê³ ë¦¬ì¦˜**ì„ ì‚¬ìš©í•˜ì—¬ **ìµœì  ê²½ë¡œë¥¼ ê³„ì‚°**

â€‹	â€¢	ì´ ê³¼ì •ì„ **SPF(Shortest Path First) ì•Œê³ ë¦¬ì¦˜**

------

 **OSPF ê²½ë¡œ ì„ íƒ ê³¼ì •**

1. **Hello íŒ¨í‚·ì„ ì£¼ê³ ë°›ì•„ ì´ì›ƒ(Neighbor) ê´€ê³„ í˜•ì„±**

2. **LSA(Link-State Advertisement) ì •ë³´ë¥¼ ì„œë¡œ êµí™˜**

3. **SPF ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ì—¬ ìµœì  ê²½ë¡œ ê³„ì‚°**

4.  **ë¼ìš°íŒ… í…Œì´ë¸”ì— ê²½ë¡œ ë°˜ì˜**

5.  **ë„¤íŠ¸ì›Œí¬ ë³€í™” ë°œìƒ ì‹œ ë‹¤ì‹œ ê³„ì‚°í•˜ì—¬ ìµœì  ê²½ë¡œ ì—…ë°ì´íŠ¸**

------

ì£¼ì˜ì 

* ë§Œì•½ ë£¨í”„ë°± Idë¥¼ ì¸í„°í˜ì´ìŠ¤ì— IP ì£¼ì†Œê°€ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ê·¸ ì¤‘ì—ì„œ ê°€ì¥ ë†’ì€ ê²ƒì´ ë¼ìš°í„° IDê°€ ëœë‹¤.
* ë§Œì•½ ë£¨í”„ë°± ì¸í„°í˜ì´ìŠ¤ê°€ ì—†ìœ¼ë©´, ê°€ì¥ ë†’ì€ IP ì£¼ì†Œê°€ ë¼ìš°í„° IDê°€ ëœë‹¤.
* OSPF ì—ì–´ë¦¬ì–´ ë²ˆí˜¸ëŠ” 32ë¹„íŠ¸ì´ë©°, 10ì§„ìˆ˜ë¥¼ ì‚¬ìš©í•´ë„ ë˜ê³  ì£¼ì†Œ í˜•ì‹ìœ¼ë¡œ ì‚¬ìš©í•´ë„ ëœë‹¤.
* ì—ì–´ë¦¬ì–´ê°€ 2ê°œ ì´ìƒì¼ ë•ŒëŠ” ê·¸ ì¤‘ í•˜ë‚˜ëŠ” ë°˜ë“œì‹œ ë°±ë³¸ ì—ì–´ë¦¬ì–´ê°€ ë˜ì–´ì•¼ í•˜ê³ , ë°±ë³¸ ì—ì–´ë¦¬ì–´ëŠ” í•­ìƒ ì—ì–´ë¦¬ì–´ ë²ˆí˜¸ê°€ 0 ë˜ëŠ” 0.0.0.0ì´ ë˜ì–´ì•¼ í•œë‹¤.

------

router ê²½ë¡œ ì„¤ì •

```bash
# router ospf process ID
```

MPLS VPNì—ì„œ OSPF í”„ë¡œì„¸ì„œ idë¥¼ ë‹¬ë¦¬ ì„¤ì •í•œë‹¤.

```bash
# router-id 1.1.1.1 <- ì‹ë³„ì
```

ë„¤íŠ¸ì›Œí¬ ë“±ë¡(ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œì™€ ì™€ì¼ë“œ ì¹´ë“œ ì§€ì •)

```bash
# network 1.1.1.1 0.0.0.0 area 1 
```

â€‹	â€¢	1.1.1.1 â†’ OSPFë¥¼ í™œì„±í™”í•  IP ì£¼ì†Œ(ì¸í„°í˜ì´ìŠ¤ì˜ IP)

â€‹	â€¢	1.1.1.1 â†’ OSPFë¥¼ í™œì„±í™”í•  IP ì£¼ì†Œ(ì¸í„°í˜ì´ìŠ¤ì˜ IP)

â€‹	â€¢	area 1 â†’ OSPF ì˜ì—­(Area 1ì— í¬í•¨ë¨)

------

### ì™€ì¼ë“œ ì¹´ë“œ ì—°ìŠµ

/24 subnet mask

-> 255.255.255.0 (11.... 0000 0000) - wilidcard mask = 0.0.0.255 (0000 ..... 1111 1111)

```bash
int lo 0
ip add 1.1.1.1 255.255.255.0

router ospf 1
network 1.1.1.0 0.0.0.255 area 1
```



------

OSPF ê²½ë¡œ ì„¤ì •

R1

```bash
conf t
router ospf 1
router-id 1.1.1.1 # ë‹¤ë¥¸ ë¼ìš°í„°ì—ì„œ ì›ê²©ì ‘ì†í• ë•Œ ì“°ëŠ” ID
network 1.1.1.1 0.0.0.0 area 1
network 1.1.123.1 0.0.0.0 area 1 # hello íŒ¨í‚·ì„ ë¿Œë¦¬ê² ë‹¤ëŠ” ì˜ë¯¸ and ë¼ìš°í„° 2,3ì— ë³´ë‚´ê² ë‹¤ëŠ” ì˜ë¯¸
```

R2

```bash
conf t
router ospf 1
router-id 1.1.2.2
network 1.1.2.2 0.0.0.0 area 0
network 1.1.123.2 0.0.0.0 area 1
network 1.1.24.2 0.0.0.0 area 0
```

R3

```bash
conf t
router ospf 1
router-id 1.1.3.3
network 1.1.3.3 0.0.0.0 area 0
network 1.1.123.3 0.0.0.0 area 1
network 1.1.34.3 0.0.0.0 area 0
```

R4

```bash
conf t
router ospf 1
router-id 1.1.4.4
network 1.1.4.4 0.0.0.0 area 0
network 1.1.24.4 0.0.0.0 area 0
network 1.1.34.4 0.0.0.0 area 0
network 1.1.45.4 0.0.0.0 area 45
```

R5

```bash
conf t
router ospf 1
router-id 1.1.5.5
network 1.1.5.5 0.0.0.0 area 45
network 1.1.45.5 0.0.0.0 area 45
```

------

ë¼ìš°íŒ… í…Œì´ë¸”

OSPFë¥¼ í†µí•˜ì—¬ ì „ì†¡ë°›ì€ ë„¤íŠ¸ì›Œí¬ ì•ì—ëŠ” 'O'ë¼ëŠ” ê¹‹ê°€ í‘œì‹œë˜ì–´ ìˆë‹¤.

ì´ë¥¼ ì›ë˜ì˜ ì„œë¸Œë„· ë§ˆìŠ¤í¬ ê°’ìœ¼ë¡œ ê´‘ê³ í•˜ê²Œ í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì¸í„°í˜ì´ìŠ¤ ì„¤ì • ëª¨ë“œì—ì„œ ip ospf network pont-to-point ëª…ë ¹ì–´ ì‚¬ìš©

```bash
R4(config-if)#do sh ip ro ospf
Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
       N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2
       E1 - OSPF external type 1, E2 - OSPF external type 2
       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
       ia - IS-IS inter area, * - candidate default, U - per-user static route
       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
       a - application route
       + - replicated route, % - next hop override

Gateway of last resort is not set

      1.0.0.0/8 is variably subnetted, 13 subnets, 2 masks
O IA     1.1.1.0/24 [110/21] via 1.1.34.3, 00:20:58, Ethernet0/2
                    [110/21] via 1.1.24.2, 00:20:59, Ethernet0/1
O        1.1.2.0/24 [110/11] via 1.1.24.2, 00:21:18, Ethernet0/1
O        1.1.3.0/24 [110/11] via 1.1.34.3, 01:31:24, Ethernet0/2
O        1.1.5.0/24 [110/11] via 1.1.45.5, 01:10:29, Ethernet0/3
O IA     1.1.123.0/24 [110/20] via 1.1.34.3, 00:24:01, Ethernet0/2
                      [110/20] via 1.1.24.2, 00:21:18, Ethernet0/1

```



------

## OSPF ê²½ë¡œ ì„¤ì • (ë£¨í”„ë°± ì„¤ì •)

### R1

```bash
conf t
interface loopback 0
 ip address 1.1.1.1 255.255.255.0
 ip ospf 1 area 1
!
interface ethernet 0/0
 ip address 1.1.123.1 255.255.255.0
 ip ospf 1 area 1
```



### R2

```bash
conf t
interface loopback 0
 ip address 1.1.2.2 255.255.255.0
 ip ospf 1 area 0
!
interface ethernet 0/0
 ip address 1.1.123.2 255.255.255.0
 ip ospf 1 area 1
!
interface ethernet 0/1
 ip address 1.1.24.2 255.255.255.0
 ip ospf 1 area 0
```



### R3

```bash
conf t
interface loopback 0
 ip address 1.1.3.3 255.255.255.0
 ip ospf 1 area 0
!
interface ethernet 0/0
 ip address 1.1.123.3 255.255.255.0
 ip ospf 1 area 1
!
interface ethernet 0/2
 ip address 1.1.34.3 255.255.255.0
 ip ospf 1 area 0
```



### R4

```bash
conf t
interface loopback 0
 ip address 1.1.4.4 255.255.255.0
 ip ospf 1 area 0
!
interface ethernet 0/1
 ip address 1.1.24.4 255.255.255.0
 ip ospf 1 area 0
!
interface ethernet 0/2
 ip address 1.1.34.4 255.255.255.0
 ip ospf 1 area 0
!
interface ethernet 0/3
 ip address 1.1.45.4 255.255.255.0
 ip ospf 1 area 45
```



### R5

```bash
conf t
interface loopback 0
 ip address 1.1.5.5 255.255.255.0
 ip ospf 1 area 45
!
interface ethernet 0/3
 ip address 1.1.45.5 255.255.255.0
 ip ospf 1 area 45
```



------

## OSPF íŒ¨í‚·

| íŒ¨í‚· íƒ€ì… |        íŒ¨í‚· ì´ë¦„        |            ì—­í•             |
| :-------: | :---------------------: | :------------------------: |
|     1     |          hello          |    ë„¤ì´ë²„ êµ¬ì„± ë° ìœ ì§€     |
|     2     |  Database Description   |   ë°ì´í„°ë² ì´ìŠ¤ ë‚´ìš© ìš”ì•½   |
|     3     |   Link State Request    | ë°ì´í„°ë² ì´ìŠ¤ ìƒì„¸ë‚´ìš© ìš”ì²­ |
|     4     | Link State Update (LSU) |   ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸    |
|     5     |  Link State Ack (LSA)   |          ACK ì „ì†¡          |



LSA - íŒ¨í‚·ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜ì‹ í–ˆìŒì„ ì•Œë ¤ì¤„ ë•Œ, ìƒíƒœ ì •ë³´ë¥¼ ë³´ë‚´ëŠ” íŒ¨í‚·

---
title: <h0>Module 5 Organize</h0>
author: cotes   
categories: [cisco virtual cloud, 2025-03-05-cisco]
tags: [Network, Cloud]




---

# Module 5 Organize

------

## 가상스위치

![image-20250305171821361](/assets/cisco_post_img/2025-03-05-Module 5 organize//image-20250305171821361.png)

**가상 머신(VM)은 가상 스위치(Virtual Switch)에 VM 포트(VM Port)를 통해 연결**된다.

**VM 포트(VM Port)의 역할**

1. **가상 머신과 가상 스위치 연결**
   * VM은 가상 네트워크 인터페이스 카드(vNIC)를 가지고 있으며, **이 vNIC가 VM 포트를 통해 가상 스위치에 연결**된다.
   * 마치 물리적 서버가 물리적 스위치의 포트에 연결되는 것과 같은 원리이다.

2. **VM 간 통신 담당**

   * 같은 포트 그룹(Port Group) 내에 있는 VM끼리는 **가상 스위치를 통해 직접 통신 가능**하다.

   * 다른 포트 그룹에 속한 VM끼리는 **VLAN 태깅을 사용하여 트래픽을 분리 및 라우팅**할 수 있다.

3. **물리 네트워크 연결**
   * VM 포트가 연결된 **포트 그룹에 업링크 포트(Uplink Port)가 설정되어 있다면**,

해당 VM은 **물리 네트워크를 통해 외부 네트워크와도 통신 가능**하다.

* 업링크가 없는 경우, **해당 포트 그룹 내 VM끼리만 통신 가능**하다.

**VM 포트와 VMkernel 포트 차이**

| **구분**               | **VM 포트(VM Port)**      | **VMkernel 포트(VMkernel Port)**        |
| ---------------------- | ------------------------- | --------------------------------------- |
| **주요 목적**          | VM끼리의 네트워크 연결    | ESXi 호스트가 관리 트래픽을 처리        |
| **연결 대상**          | 가상 머신(vNIC)           | ESXi VMkernel (vMotion, 스토리지, 관리) |
| **포트 그룹 유형**     | VM 포트 그룹              | VMkernel 포트 그룹                      |
| **외부 네트워크 연결** | 업링크 포트가 있으면 가능 | 반드시 IP 설정 필요                     |

결론적으로, **VM 포트는 가상 머신을 가상 스위치에 연결하는 역할**을 하며, VM들이 서로 통신하고 외부 네트워크에 접근할 수 있도록 해준다.

------

------

## UpLink 의 역할

**업링크(Uplink)는 단순히 외부 네트워크와 연결하는 역할뿐만 아니라, 다양한 네트워크 트래픽을 처리하는 중요한 기능을 한다.**

**업링크(Uplink)의 주요 역할**

1. ------

   **가상 네트워크와 물리 네트워크 연결**

   * 가상 스위치(Virtual Switch)는 물리적으로 독립된 네트워크 구조이므로, **외부 네트워크와 연결하기 위해 업링크가 필요**하다.
   * 업링크는 **물리 NIC(vmnic, Physical NIC)** 에 연결되며, 이를 통해 **가상 머신과 물리 네트워크 간 트래픽을 전달**한다.
   * 업링크가 없으면, 가상 네트워크는 **물리 네트워크와 격리된 상태로 동작**하게 된다.

2. ------

   **트래픽 분배 및 로드 밸런싱**

   * 여러 개의 물리 NIC(vmnic)를 업링크로 설정하면 **NIC 팀(NIC Teaming) 구성 가능**
   * *로드 밸런싱 설정**을 통해 VM들이 물리 NIC 리소스를 균등하게 사용할 수 있도록 분산 가능**
   * **사용 가능한 **로드 밸런싱 알고리즘
   * Originating Virtual Port ID** (기본값, 포트 단위로 트래픽 분배)
   * **MAC Hash 기반** (VM의 MAC 주소 기반으로 트래픽을 특정 NIC에 할당)
   * **IP Hash 기반** (출발지 및 목적지 IP를 해시 계산하여 트래픽을 균등 분배, LACP 필요)
   * **명시적 페일오버 순서 사용** (우선순위를 기반으로 트래픽 전달)

3. ------

   **가상 머신 및 VMkernel 트래픽 전달**

   * VM 포트 그룹과 VMkernel 포트 그룹에서 발생하는 트래픽을 **외부 네트워크로 전달**하는 역할을 한다.
   * **VM 트래픽**
   * VM이 인터넷, 사내 네트워크, 다른 VLAN의 VM과 통신할 때 업링크 사용
   * **VMkernel 트래픽**
   * vMotion, IP Storage(iSCSI, NFS), vSAN, ESXi 관리 트래픽 등을 물리 네트워크로 전달
   * **VLAN 태깅 지원**
   * 업링크가 물리 스위치와 연결될 때 **802.1Q VLAN 태깅**을 사용하여 네트워크 트래픽을 분리 가능
   * 예를 들어, **vMotion 트래픽과 관리 트래픽을 서로 다른 VLAN으로 분리 가능**

4. ------

   **고가용성(HA) 및 장애 복구(Failover) 기능 제공**

   * 다중 업링크를 사용하면 **하나의 업링크가 다운되었을 때 자동으로 다른 업링크로 트래픽을 전환**
   * 이를 **NIC 페일오버(NIC Failover) 기능**이라고 하며, 네트워크 가용성을 높이는 데 중요한 역할을 함
   * 페일오버 정책에는 **Active/Standby 방식**과 **Active/Active 방식**이 있음
   * **Active/Standby**: 기본 업링크 장애 시 예비 업링크로 전환
   * **Active/Active**: 모든 업링크를 동시에 사용하면서 장애 발생 시 해당 트래픽을 다른 업링크로 자동 전환

------

✅ **물리 네트워크와 가상 네트워크 연결**

✅ **NIC 팀을 통한 로드 밸런싱 및 트래픽 분산**

✅ **VM 및 VMkernel 트래픽 전달**

✅ **VLAN 태깅 및 네트워크 분리 지원**

✅ **NIC 장애 발생 시 자동 페일오버 기능 제공**

------

즉, 업링크는 가상화된 네트워크 환경에서 **성능, 가용성, 보안, 트래픽 관리 등 다양한 기능을 담당하는 핵심 요소**이다.

------

------

## 개별 가상 스위치 연결

![image-20250305174334563](/assets/cisco_post_img/2025-03-05-Module 5 organize//image-20250305174334563.png)

네트워크 환경을 설계할 때, 모든 네트워크를 **하나의 가상 스위치(Virtual Switch)** 에 그룹화할 수도 있고, **여러 개의 개별 가상 스위치**를 선택할 수도 있다.

이 결정은 물리적 네트워크의 구성에 따라 달라진다.



예를 들어, 각 네트워크에 대해 별도의 가상 스위치를 생성할 만큼 **충분한 물리적 네트워크 어댑터(NIC)** 가 없을 수도 있다.

이 경우 **하나의 가상 스위치**에 모든 네트워크 어댑터를 배치하고, **VLAN을 사용하여 네트워크를 논리적으로 분리**할 수 있다.



또한, 물리적 NIC(업링크)는 **가상 스위치 수준에서 할당되므로**, 특정 스위치에 정의된 모든 포트와 포트 그룹은 **동일한 물리적 네트워크 어댑터를 공유**한다.

**그림의 구조 및 설명**

------

그림에서는 **두 가지 방식의 가상 스위치 설계**를 비교하고 있다.

1. **하나의 가상 스위치에서 모든 네트워크 관리 (위쪽 구조)**

   * 모든 네트워크(Production, TestDev, DMZ, vMotion, Management)가 **하나의 가상 스위치**에서 운영된다.

   * 물리적 NIC 자원이 충분하지 않을 때 **VLAN을 사용하여 네트워크를 논리적으로 분리**할 수 있다.

   * 이 방식은 **관리 편의성 증가** 및 **자원 활용 극대화**의 장점이 있지만, 트래픽이 집중될 경우 성능 저하가 발생할 수 있다.

2. **각 네트워크별로 개별 가상 스위치 구성 (아래쪽 구조)**

   * 각 네트워크(Production, TestDev, DMZ 등)가 **별도의 가상 스위치**를 사용하여 운영된다.

   * 이 방식은 **네트워크 트래픽을 완전히 분리**하여 보안 및 성능을 향상할 수 있다.

   * 하지만 물리적 NIC 리소스가 충분해야 하며, 관리 복잡성이 증가할 수 있다.

------

**결론**

✅ **NIC 자원이 부족하면 하나의 가상 스위치 + VLAN 사용**

✅ **각 네트워크를 완전히 분리하려면 개별 가상 스위치 사용**

✅ **가상 스위치 수준에서 물리적 NIC를 공유하기 때문에 트래픽 관리 중요**

즉, **네트워크 설계 시 가용한 NIC 리소스와 보안 및 성능 요구 사항을 고려하여 가상 스위치 방식을 선택해야 한다.**

------

## Question

------

**질문 1: 위의 가상 스위치에서 업링크는 4개인데 부족하지 않은가? 업링크가 최소한 몇 개는 있어야 하는가?**

업링크(물리 NIC)는 가상 스위치에서 **외부 네트워크와 연결하는 역할**을 하므로, 충분한 수가 필요하다. 업링크의 최소 개수는 다음 요소에 따라 달라진다.

​	1.	**네트워크 트래픽 유형**

​	2.	**고가용성(HA) 및 이중화(Redundancy)**

​	3.	**네트워크 대역폭**

💡 **최소 업링크 개수 추천:**

* **일반적인 환경:** 최소 **2개 (Active-Standby)**
* *고성능 환경:** 최소 **4개 (각 트래픽에 분리 배정)**
* *대규모 트래픽 환경:** 6개 이상 (부하 분산 및 네트워크 이중화)

➡ **그림에서 4개 업링크는 보편적인 최소 개수지만, 특정 환경에서는 부족할 수 있다.**

------

**질문 2: 그림에서 VLAN은 어디 있는가?**

그림에서 VLAN 자체는 **명시적으로 보이지 않지만, 논리적으로 구현될 수 있는 개념**이다.

1. **VLAN은 포트 그룹(Port Group) 단위로 설정**

   * 그림에서 “Production”, “TestDev”, “DMZ” 등의 포트 그룹이 VLAN 역할을 한다.

   * 실제 VLAN ID(예: VLAN 10, 20, 30)가 각 포트 그룹에 할당되면 VLAN 태깅이 적용된다.

2. **업링크를 공유하면서도 VLAN 태그로 트래픽을 분리**
   * 같은 가상 스위치 내에서도 VLAN ID를 다르게 설정하면 **서로 다른 논리적 네트워크로 격리**할 수 있다.
     * 예:
       * **Production (VLAN 10)**
       * *TestDev (VLAN 20)
       * DMZ (VLAN 30)**

💡 **즉, VLAN은 가상 스위치 내부에 물리적으로 존재하는 것이 아니라, 포트 그룹과 업링크 사이에서 논리적으로 동작하는 것이다.**

------

**질문 3: 왜 아래 그림에서는 각 가상 스위치마다 2개씩 업링크를 가져서 총 10개가 되었는가?**



위 그림(단일 가상 스위치)에서는 **모든 네트워크가 4개의 공유 업링크를 사용**하지만,

아래 그림(여러 개의 가상 스위치)에서는 **각 가상 스위치가 독립적인 업링크를 가짐**으로써 총 10개가 된다.

1. **네트워크 분리 (Isolation)**
   * 위 그림에서는 **하나의 가상 스위치에서 VLAN으로 트래픽을 논리적으로 분리**했다.
   * 아래 그림에서는 **각 네트워크별 개별 가상 스위치를 사용**하여 물리적으로도 분리했다.

2. **업링크 증가 이유**
   * 단일 스위치를 사용할 때는 4개 업링크를 공유하지만, 여러 개의 가상 스위치를 사용할 경우 **각 스위치마다 별도 업링크가 필요**하다.
   * 따라서, 예를 들어 5개의 개별 가상 스위치를 운영할 경우 **각 스위치가 2개씩 업링크를 가지면 총 10개가 필요**하다.



💡 **즉, 업링크 개수가 증가한 이유는 네트워크 격리 수준을 높이고, 각 가상 스위치가 독립적인 물리적 리소스를 가지도록 설계했기 때문이다.**



------

**질문 4:  그럼 여기서 개별 가상 스위치가 가져야할 업링크 갯수는 2개가 일반적인가?**



✔ **일반적인 환경에서는 업링크 2개가 표준적이며 권장됨.**

✔ 네트워크 부하가 크거나 고가용성이 필수라면 **4개 이상 사용 가능**.

✔ 업링크 개수는 **트래픽 유형(Management, VM, vMotion, vSAN 등)과 네트워크 아키텍처에 따라 조정 가능**.

------

------

## VLAN 과 가상 스위치의 VLAN 태깅

![image-20250305181455119](/assets/cisco_post_img/2025-03-05-Module 5 organize//image-20250305181455119.png)

**번역**



**VLAN과 가상 스위치 태깅에 대한 개요**

* ESXi는 **VLAN ID를 포트 그룹에 할당**하여 VLAN을 지원함.
* **802.1Q VLAN 태깅을 지원**하며, 가상 스위치 태깅 방식 중 하나를 사용할 수 있음.

**VLAN 태깅 방식**

* **VM에서 나가는 프레임**은 **VLAN 태그를 포함**하여 가상 스위치를 통해 전송됨.
* **가상 스위치에 도착한 태깅된 프레임**은 **VM으로 전달되기 전에 태그가 제거됨**.
* **물리적 스위치 포트는 트렁크 포트(Trunk Port)로 구성되어야 함.**

**VLAN의 개념 및 장점**

* VLAN은 **논리적으로 네트워크를 그룹화**할 수 있음.
* 같은 VLAN에 속한 VM과 포트는 **물리적인 연결 방식과 상관없이 같은 네트워크에 있는 것처럼 통신 가능**.
* VLAN을 사용하면 다음과 같은 이점을 얻을 수 있음:
* **물리적 네트워크 구조에 구애받지 않고 논리적 네트워크 구성 가능.**
* *브로드캐스트 트래픽을 제한하여 성능을 향상시킬 수 있음.
* 추가적인 라우터 배치 없이 네트워크를 구분할 수 있어 비용 절감 가능.**



**ESXi의 VLAN 구성**

* VLAN은 **포트 그룹 수준에서 설정**됨.
* ESXi 호스트는 **가상 스위치 태깅(VST, Virtual Switch Tagging)을 사용하여 VLAN 지원**.
* **기본 VLAN ID는 0이며**, VMkernel이 패킷이 가상 스위치를 통과할 때 태깅과 언태깅을 처리함.



**물리적 스위치에서의 VLAN 설정**

​	•	ESXi 호스트가 연결된 물리적 스위치의 포트는 **고정 트렁크 포트(Static Trunk Port)로 설정해야 함**.

​	•	**VM 내부에서는 VLAN을 인식하지 않음**, 즉 VLAN 설정이 필요 없음.

**그림 설명**

1. **VM과 VLAN 연결**
   * **두 개의 가상 머신(VM)이 가상 스위치(Virtual Switch)에 연결**되어 있음.
   * 첫 번째 VM은 **Production VLAN 105**에 속해 있으며, 두 번째 VM은 **Test VLAN 106**에 속해 있음.
   * 가상 스위치는 VM에서 나오는 패킷에 **VLAN 태그(105 또는 106)를 추가**하여 구분함.

2. **가상 스위치의 역할**
   * VM에서 나오는 패킷은 **가상 스위치가 태깅(VLAN ID 추가)한 후 물리적 네트워크로 전달**됨.
   * **반대로 물리적 네트워크에서 들어오는 패킷은 가상 스위치가 VLAN 태그를 제거한 후 VM으로 전달**됨.

3. **업링크와 물리적 스위치**
   * 가상 스위치에서 나온 트래픽은 **업링크를 통해 물리적 네트워크로 연결**됨.
   * 물리적 네트워크에 있는 **스위치 포트는 트렁크 모드**로 설정되어 VLAN 태깅된 패킷을 전송하고 처리함.

4. **VLAN 설정 화면**
   * “Production - Edit Settings” 화면에서는 **VLAN ID 105가 설정된 포트 그룹이 확인됨**.
   * 이 설정을 통해 **Production VLAN 105에 속한 VM은 같은 VLAN 내에서만 통신할 수 있도록 제한됨**.



**결론**

* **VLAN을 사용하면 하나의 가상 스위치에서 여러 개의 논리적 네트워크를 생성**할 수 있음.
* **VM은 VLAN을 인식하지 않으며, 가상 스위치가 VLAN 태깅을 수행**하여 네트워크를 분리함.
* **업링크 포트와 물리적 스위치는 트렁크 모드로 설정해야 네트워크가 정상적으로 동작**함.

------

## Question

------

**질문 1. 왜 VLAN 태깅을 사용해야 하는가?**

VLAN 태깅을 사용하는 이유는 **네트워크의 논리적 분리와 효율적인 트래픽 관리** 때문이다.

​	•	**가상 환경에서의 네트워크 분리**

​	•	하나의 가상 스위치(Virtual Switch)에서 여러 개의 서로 다른 네트워크(VLAN)를 구성할 수 있음.

​	•	예를 들어, **Production VLAN(105)**과 **Test VLAN(106)**이 같은 가상 스위치에서 동작하지만 서로 격리되어 있음.

------

**질문 2. 왜 포트 그룹 수준에서 VLAN을 설정해야 하는가?**



VLAN은 **개별 포트(가상 머신)마다 설정하는 것이 아니라, 포트 그룹(Port Group) 단위로 설정**하는 것이 일반적이다.

그 이유는 다음과 같다.

* **관리 효율성**

  * 같은 네트워크에 속하는 여러 VM을 하나의 포트 그룹(예: Production Port Group, Test Port Group)에 속하게 하면 **일괄적으로 VLAN을 설정할 수 있음**.

  * 만약 개별 VM마다 VLAN을 설정해야 한다면 **운영 및 관리가 매우 번거로워짐**.

* **일관된 네트워크 정책 적용**
  * 포트 그룹 내 모든 VM이 동일한 네트워크 설정을 유지할 수 있음.
  * 예를 들어, **Production Port Group(VLAN 105)에 속한 모든 VM은 VLAN 105를 사용해야 함**.
  * 만약 포트 그룹이 아니라 개별 VM마다 VLAN을 설정한다면 **일관성 유지가 어려움**.

------

**질문 3. VLAN 태깅이 있으면 업링크 포트는 트렁크 모드로 꼭 설정해야 하는가?**

**VLAN 태깅을 사용할 경우 업링크 포트는 트렁크(Trunk) 모드로 설정해야 한다**.

그 이유는 다음과 같다.

​	•	**VLAN 태깅된 트래픽을 물리적 네트워크에서도 유지해야 하기 때문**

​	•	**업링크 포트가 액세스(Access) 모드라면 특정 VLAN 하나만 허용**되므로, 여러 VLAN을 처리할 수 없음.

​	•	트렁크(Trunk) 모드라면 **여러 VLAN의 태깅된 트래픽을 동시에 전달할 수 있음**.